"use strict";(self.webpackChunkXray_docs_next=self.webpackChunkXray_docs_next||[]).push([[1241],{51354:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-930ac920",path:"/en/document/level-2/redirect.html",title:"出站流量重定向",lang:"en-US",frontmatter:{title:"出站流量重定向"},excerpt:"",headers:[{level:2,title:"前言",slug:"前言",children:[]},{level:2,title:"1、安装代理或者 VPN 软件（例如 Wireguard、IPsec 等）",slug:"_1、安装代理或者-vpn-软件-例如-wireguard、ipsec-等",children:[]},{level:2,title:"2、编辑 VPN 配置文件（以 WireGuard 为例）",slug:"_2、编辑-vpn-配置文件-以-wireguard-为例",children:[]},{level:2,title:"3、启用 WireGuard 网络接口",slug:"_3、启用-wireguard-网络接口",children:[]},{level:2,title:"4、Xray-core 配置文件修改",slug:"_4、xray-core-配置文件修改",children:[]},{level:2,title:"5、系统设置配置",slug:"_5、系统设置配置",children:[]},{level:2,title:"6、完成 WireGuard 相关设置",slug:"_6、完成-wireguard-相关设置",children:[]},{level:2,title:"后记",slug:"后记",children:[]},{level:2,title:"感谢",slug:"感谢",children:[]}],filePathRelative:"en/document/level-2/redirect.md",git:{updatedTime:1622027153e3,contributors:[{name:"hmol233",email:"82594500+hmol233@users.noreply.github.com",commits:1}]}}},18275:(n,s,a)=>{a.r(s),a.d(s,{default:()=>d});var e=a(66252);const t=(0,e.uE)('<h1 id="基于-fwmark-或-sendthrough-的流量重定向" tabindex="-1"><a class="header-anchor" href="#基于-fwmark-或-sendthrough-的流量重定向" aria-hidden="true">#</a> 基于 fwmark 或 sendThrough 的流量重定向</h1><p>通过 Xray 将特定的流量指向特定出口，实现全局路由“分流”</p><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>之前在网络上看到许多代理或者 VPN 会接管全局路由，如果与 Xray 同时安装，会导致 Xray 失效。参考了网络上许多教程，及时分流，也是通过维护一张或者多张 CIDR 路由表来实现的。这种情况下并不优雅，如果我想可以任意替换，实现按需分流，那有没有更好的办法呢？有！</p><p>通过 fwmark 或 Xray 的 sendThrough，再简单配合路由表功能即可实现：</p><ol><li>Xray 可设置指定的 Tag、域名等走指定接口。如果您的接口是双栈的，可以指定 IPV4 或者 IPV6</li><li>其余用户则走原 IPV4 或者 IPV6</li></ol><p>具体设置如下（以 Debian10 为例）：</p><h2 id="_1、安装代理或者-vpn-软件-例如-wireguard、ipsec-等" tabindex="-1"><a class="header-anchor" href="#_1、安装代理或者-vpn-软件-例如-wireguard、ipsec-等" aria-hidden="true">#</a> 1、安装代理或者 VPN 软件（例如 Wireguard、IPsec 等）</h2><p>根据不同系统和不同软件，请参考官方安装方法</p><h2 id="_2、编辑-vpn-配置文件-以-wireguard-为例" tabindex="-1"><a class="header-anchor" href="#_2、编辑-vpn-配置文件-以-wireguard-为例" aria-hidden="true">#</a> 2、编辑 VPN 配置文件（以 WireGuard 为例）</h2><p>原始文件：</p>',11),l=(0,e._)("div",{class:"language-ini ext-ini line-numbers-mode"},[(0,e._)("pre",{class:"language-ini"},[(0,e._)("code",null,[(0,e._)("span",{class:"token header"},[(0,e._)("span",{class:"token punctuation"},"["),(0,e._)("span",{class:"token section-name selector"},"Interface"),(0,e._)("span",{class:"token punctuation"},"]")]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PrivateKey"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"xxxxxxxxxxxxxxxxxxxx"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"Address"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},[(0,e.Uk)('"'),(0,e._)("span",{class:"token inner-value"},"your wg0 v4 address"),(0,e.Uk)('"')]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"Address"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},[(0,e.Uk)('"'),(0,e._)("span",{class:"token inner-value"},"your wg0 v6 address"),(0,e.Uk)('"')]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"DNS"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"8.8.8.8"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"MTU"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"1280"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token header"},[(0,e._)("span",{class:"token punctuation"},"["),(0,e._)("span",{class:"token section-name selector"},"Peer"),(0,e._)("span",{class:"token punctuation"},"]")]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PublicKey"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"xxxxxxxxxxxxxxxxxxxxx"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"AllowedIPs"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"::/0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"AllowedIPs"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"0.0.0.0/0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"Endpoint"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},[(0,e.Uk)('"'),(0,e._)("span",{class:"token inner-value"},"ip:port"),(0,e.Uk)('"')]),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br")])],-1),p=(0,e._)("p",null,[(0,e.Uk)("在 "),(0,e._)("code",null,"[Interface]"),(0,e.Uk)(" 下添加如下命令：")],-1),o=(0,e._)("div",{class:"language-ini ext-ini line-numbers-mode"},[(0,e._)("pre",{class:"language-ini"},[(0,e._)("code",null,[(0,e._)("span",{class:"token key attr-name"},"Table"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"off"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -4 rule add fwmark <mark> lookup <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -4 route add default dev <接口名称> table <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -4 rule add table main suppress_prefixlength 0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule add fwmark <mark> lookup <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule add not fwmark <table> table <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 route add ::/0 dev <接口名称> table <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule add table main suppress_prefixlength 0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -4 rule delete fwmark <mark> lookup <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -4 rule delete table main suppress_prefixlength 0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule delete fwmark <mark> lookup <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule delete not fwmark <table> table <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule delete table main suppress_prefixlength 0"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br")])],-1),r=(0,e._)("div",{class:"custom-container tip"},[(0,e._)("p",{class:"custom-container-title"},"TIP"),(0,e._)("ul",null,[(0,e._)("li",null,[(0,e.Uk)("此命令表示 IPv4 中 fwmark 为 "),(0,e._)("code",null,"<mark>"),(0,e.Uk)("，IPv6 中 fwmark 为"),(0,e._)("code",null,"<mark>"),(0,e.Uk)("，::/0 全局 v6 走 WireGuard")]),(0,e._)("li",null,"可根据自己需求增删命令，mark 值要与 Xray-core 中设置为相同，table 值自定"),(0,e._)("li",null,"如果不支持配置文件，可以在系统中修改路由表")])],-1),c=(0,e._)("div",{class:"language-ini ext-ini line-numbers-mode"},[(0,e._)("pre",{class:"language-ini"},[(0,e._)("code",null,[(0,e._)("span",{class:"token header"},[(0,e._)("span",{class:"token punctuation"},"["),(0,e._)("span",{class:"token section-name selector"},"Interface"),(0,e._)("span",{class:"token punctuation"},"]")]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PrivateKey"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"xxxxxxxxxxxxxxxxxxxx"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"Address"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},[(0,e.Uk)('"'),(0,e._)("span",{class:"token inner-value"},"your wg0 v4 address"),(0,e.Uk)('"')]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"Address"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},[(0,e.Uk)('"'),(0,e._)("span",{class:"token inner-value"},"your wg0 v6 address"),(0,e.Uk)('"')]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"DNS"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"8.8.8.8"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"MTU"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"1280"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token header"},[(0,e._)("span",{class:"token punctuation"},"["),(0,e._)("span",{class:"token section-name selector"},"Peer"),(0,e._)("span",{class:"token punctuation"},"]")]),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PublicKey"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"xxxxxxxxxxxxxxxxxxxxx"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"AllowedIPs"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"::/0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"AllowedIPs"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"0.0.0.0/0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"Endpoint"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},[(0,e.Uk)('"'),(0,e._)("span",{class:"token inner-value"},"ip:port"),(0,e.Uk)('"')]),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br")])],-1),k=(0,e._)("p",null,[(0,e.Uk)("在 "),(0,e._)("code",null,"[Interface]"),(0,e.Uk)(" 下添加如下命令：")],-1),_=(0,e._)("div",{class:"language-ini ext-ini line-numbers-mode"},[(0,e._)("pre",{class:"language-ini"},[(0,e._)("code",null,[(0,e._)("span",{class:"token key attr-name"},"Table"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"off"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},'ip -4 rule add from "your wg0 v4 address" lookup <table>'),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -4 route add default dev wg0 table <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -4 rule add table main suppress_prefixlength 0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule add not fwmark <table> table <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 route add ::/0 dev wg0 table <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostUP"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule add table main suppress_prefixlength 0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},'ip -4 rule delete from "your wg0 v4 address" lookup <table>'),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -4 rule delete table main suppress_prefixlength 0"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule delete not fwmark <table> table <table>"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token key attr-name"},"PostDown"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"="),(0,e.Uk)(),(0,e._)("span",{class:"token value attr-value"},"ip -6 rule delete table main suppress_prefixlength 0"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br")])],-1),u=(0,e._)("div",{class:"custom-container tip"},[(0,e._)("p",{class:"custom-container-title"},"TIP"),(0,e._)("ul",null,[(0,e._)("li",null,[(0,e.Uk)("此命令表示 IPV4 中来自 "),(0,e._)("code",null,"your wg0 v4 address"),(0,e.Uk)(" 地址的走 WireGuard，IPv6 中::/0 全局 v6 走 WireGuard）")]),(0,e._)("li",null,"可根据自己需求增删命令，实现 v6 分流，也可以与 fwmark 融合"),(0,e._)("li",null,"如果不支持配置文件，可以在系统中修改路由表")])],-1),i=(0,e.uE)('<p>保存</p><p>可顺手安装</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">apt</span> <span class="token function">install</span> openresolv\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="_3、启用-wireguard-网络接口" tabindex="-1"><a class="header-anchor" href="#_3、启用-wireguard-网络接口" aria-hidden="true">#</a> 3、启用 WireGuard 网络接口</h2><p>加载内核模块</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>modprobe wireguard\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>检查 WG 模块加载是否正常</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>lsmod <span class="token operator">|</span> <span class="token function">grep</span> wireguard\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="_4、xray-core-配置文件修改" tabindex="-1"><a class="header-anchor" href="#_4、xray-core-配置文件修改" aria-hidden="true">#</a> 4、Xray-core 配置文件修改</h2>',9),b=(0,e._)("div",{class:"language-json ext-json line-numbers-mode"},[(0,e._)("pre",{class:"language-json"},[(0,e._)("code",null,[(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"api"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token property"},'"services"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token string"},'"HandlerService"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token string"},'"LoggerService"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token string"},'"StatsService"'),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token property"},'"tag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"api"'),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"inbounds"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"listen"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"127.0.0.1"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"port"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(" <port>"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"dokodemo-door"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"settings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"address"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"127.0.0.1"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"tag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"api"'),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"outbounds"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"freedom"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"settings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"domainStrategy"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"UseIPv6"'),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token comment"},"//设置默认用户走指定方式”UseIPv6”或者”UseIPv4”"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"freedom"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"tag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"wg0"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"streamSettings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"sockopt"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token property"},'"mark"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(" <mark>\n        "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"settings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"domainStrategy"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"UseIPv6"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token comment"},"//设置fwmark为<mark>的用户走指定方式”UseIPv6””UseIPv4”"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"blackhole"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"settings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"tag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"blocked"'),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"policy"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token property"},'"system"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"statsInboundDownlink"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token boolean"},"true"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"statsInboundUplink"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token boolean"},"true"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"routing"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token property"},'"rules"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"inboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token string"},'"api"'),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"outboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"api"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"type"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"field"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"type"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"field"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"outboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"wg0"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"inboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token string"},'"<inboundTag>"'),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token comment"},"//需要之前在inbound中指定好Tag，我这里是api生成的,还可以添加域名等等"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"outboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"blocked"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token string"},'"bittorrent"'),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"type"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"field"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"stats"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"16"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"17"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"18"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"19"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"20"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"21"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"22"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"23"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"24"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"25"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"26"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"27"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"28"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"29"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"30"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"31"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"32"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"33"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"34"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"35"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"36"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"37"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"38"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"39"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"40"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"41"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"42"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"43"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"44"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"45"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"46"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"47"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"48"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"49"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"50"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"51"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"52"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"53"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"54"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"55"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"56"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"57"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"58"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"59"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"60"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"61"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"62"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"63"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"64"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"65"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"66"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"67"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"68"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"69"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"70"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"71"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"72"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"73"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"74"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"75"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"76"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"77"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"78"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"79"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"80"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"81"),(0,e._)("br")])],-1),U=(0,e._)("div",{class:"language-json ext-json line-numbers-mode"},[(0,e._)("pre",{class:"language-json"},[(0,e._)("code",null,[(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"api"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token property"},'"services"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token string"},'"HandlerService"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token string"},'"LoggerService"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token string"},'"StatsService"'),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token property"},'"tag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"api"'),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"inbounds"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"listen"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"127.0.0.1"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"port"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(" <port>"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"dokodemo-door"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"settings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"address"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"127.0.0.1"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"tag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"api"'),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"outbounds"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"freedom"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"settings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"domainStrategy"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"UseIPv4"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token comment"},"//修改此处，可v4或者v6"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"tag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"wg0"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"freedom"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"sendThrough"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"your wg0 v4 address"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token comment"},"//修改此处，可v4或者v6"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"settings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"domainStrategy"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"UseIPv4"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token comment"},"//修改此处，可v4或者v6"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"blackhole"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"settings"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"tag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"blocked"'),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"policy"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token property"},'"system"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"statsInboundDownlink"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token boolean"},"true"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token property"},'"statsInboundUplink"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token boolean"},"true"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"routing"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token property"},'"rules"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"inboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token string"},'"api"'),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"outboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"api"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"type"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"field"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"type"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"field"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"outboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"wg0"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"inboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token string"},'"<inboundTag>"'),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token comment"},"//需要之前在 inbound 中指定好 Tag，我这里是 api 生成的,还可以添加域名等等"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"outboundTag"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"blocked"'),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"protocol"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e._)("span",{class:"token string"},'"bittorrent"'),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        "),(0,e._)("span",{class:"token property"},'"type"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token string"},'"field"'),(0,e.Uk)("\n      "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e._)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token punctuation"},"}"),(0,e._)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e._)("span",{class:"token property"},'"stats"'),(0,e._)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e._)("span",{class:"token punctuation"},"{"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e._)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e._)("div",{class:"line-numbers"},[(0,e._)("span",{class:"line-number"},"1"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"2"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"3"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"4"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"5"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"6"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"7"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"8"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"9"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"10"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"11"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"12"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"13"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"14"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"15"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"16"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"17"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"18"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"19"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"20"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"21"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"22"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"23"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"24"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"25"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"26"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"27"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"28"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"29"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"30"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"31"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"32"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"33"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"34"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"35"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"36"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"37"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"38"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"39"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"40"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"41"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"42"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"43"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"44"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"45"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"46"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"47"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"48"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"49"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"50"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"51"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"52"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"53"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"54"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"55"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"56"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"57"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"58"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"59"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"60"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"61"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"62"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"63"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"64"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"65"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"66"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"67"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"68"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"69"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"70"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"71"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"72"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"73"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"74"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"75"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"76"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"77"),(0,e._)("br"),(0,e._)("span",{class:"line-number"},"78"),(0,e._)("br")])],-1),m=(0,e.uE)('<div class="custom-container tip"><p class="custom-container-title">TIP</p><p>可以通过修改 &quot;domainStrategy&quot;: &quot;UseIPv6&quot;来控制对应用户的访问方式 实测优先级要高于系统本身的 gai.config</p></div><h2 id="_5、系统设置配置" tabindex="-1"><a class="header-anchor" href="#_5、系统设置配置" aria-hidden="true">#</a> 5、系统设置配置</h2><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>需要打开系统的 ip_forward</p></div><h2 id="_6、完成-wireguard-相关设置" tabindex="-1"><a class="header-anchor" href="#_6、完成-wireguard-相关设置" aria-hidden="true">#</a> 6、完成 WireGuard 相关设置</h2><p>开启隧道</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>wg-quick up wg0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>开机自启</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> wg-quick@wg0\nsystemctl start wg-quick@wg0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>验证 IPv4/IPv6</p><blockquote><p>自行验证 Google 搜索 myip</p></blockquote><h2 id="后记" tabindex="-1"><a class="header-anchor" href="#后记" aria-hidden="true">#</a> 后记</h2><p>本文本意是可以避免的多余的流量浪费，将路由和分流的功能交给 Xray 处理。避免了维护路由表的繁琐工作。顺便技术提升 UP。</p><h2 id="感谢" tabindex="-1"><a class="header-anchor" href="#感谢" aria-hidden="true">#</a> 感谢</h2><p>@Xray-core @V2ray-core @WireGuard @p3terx @w @Hiram @Luminous @Ln @JackChou</p>',14),d={render:function(n,s){const a=(0,e.up)("Tab"),d=(0,e.up)("Tabs");return(0,e.wg)(),(0,e.iD)(e.HY,null,[t,(0,e.Wm)(d,{title:"if-config"},{default:(0,e.w5)((()=>[(0,e.Wm)(a,{title:"fwmark1"},{default:(0,e.w5)((()=>[l,p,o,r])),_:1}),(0,e.Wm)(a,{title:"sendThrough1"},{default:(0,e.w5)((()=>[c,k,_,u])),_:1})])),_:1}),i,(0,e.Wm)(d,{title:"xray-config"},{default:(0,e.w5)((()=>[(0,e.Wm)(a,{title:"fwmark2"},{default:(0,e.w5)((()=>[b])),_:1}),(0,e.Wm)(a,{title:"sendThrough2"},{default:(0,e.w5)((()=>[U])),_:1})])),_:1}),m],64)}}}}]);