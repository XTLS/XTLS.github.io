import{_ as i,r as p,o as c,c as u,a,b as n,d as s,w as e,e as k}from"./app-DEEn2vGf.js";const d={},v=n("h1",{id:"руководство-по-настроике-прозрачного-проксирования-tproxy",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#руководство-по-настроике-прозрачного-проксирования-tproxy"},[n("span",null,"Руководство по настройке прозрачного проксирования (TProxy)")])],-1),m={href:"https://guide.v2fly.org/app/tproxy.html",target:"_blank",rel:"noopener noreferrer"},b=n("p",null,"Все конфигурации, представленные в этой статье, были успешно протестированы в средах Raspberry Pi 2B и Ubuntu 20.04. При использовании в других средах вам может потребоваться изменить конфигурацию.",-1),q=n("h2",{id:"перед-началом-работы",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#перед-началом-работы"},[n("span",null,"Перед началом работы")])],-1),g=n("p",null,"Убедитесь, что на вашем устройстве есть доступное сетевое подключение, сервер настроен, а клиент установлен.",-1),y={href:"https://github.com/XTLS/Xray-core/discussions/59",target:"_blank",rel:"noopener noreferrer"},f=n("p",null,[s("Хочу добавить, что многие руководства по настройке прозрачного проксирования используют Netfilter для разделения трафика, отправляя прямой трафик напрямую, минуя Xray. В этом случае необходимо включить переадресацию IP."),n("br"),s(" Другие руководства, например это, направляют весь трафик через Xray, где он разделяется модулем маршрутизации Xray. В этом случае переадресацию IP включать не нужно.")],-1),h=n("h2",{id:"настроика-xray",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#настроика-xray"},[n("span",null,"Настройка Xray")])],-1),R={href:"https://github.com/Loyalsoldier/v2ray-rules-dat",target:"_blank",rel:"noopener noreferrer"},_=k(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-oL</span> /usr/local/share/xray/geoip.dat https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat
<span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-oL</span> /usr/local/share/xray/geosite.dat https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;loglevel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/var/log/xray/error.log&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/var/log/xray/access.log&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all-in&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dokodemo-door&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp,udp&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;followRedirect&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sniffing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;destOverride&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tls&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;sockopt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;tproxy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tproxy&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;freedom&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;domainStrategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UseIPv4&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;sockopt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;mark&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vless&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;vnext&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;домен сервера&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
            <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UUID&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;flow&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xtls-rprx-vision&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;encryption&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xtls&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sockopt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;mark&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;block&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blackhole&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns-out&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.8.8.8&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;proxySettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;sockopt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;mark&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;hosts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;домен сервера&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IP-адрес сервера&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;servers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;119.29.29.29&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
        <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geosite:cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geoip:cn&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;223.5.5.5&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
        <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geosite:cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geoip:cn&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;1.1.1.1&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;https+local://doh.dns.sb/dns-query&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;routing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;domainStrategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IPIfNonMatch&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;inboundTag&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;all-in&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns-out&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1.1.1.1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geosite:category-ads-all&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;block&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geosite:geolocation-!cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geoip:telegram&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">Совет</p><p>Эта конфигурация перехватывает весь трафик, направляемый на порт 53, для решения проблемы загрязнения DNS, поэтому адрес DNS-сервера на клиенте и на самом устройстве можно настроить произвольно.</p></div><h2 id="настроика-маршрутизации-по-политике" tabindex="-1"><a class="header-anchor" href="#настроика-маршрутизации-по-политике"><span>Настройка маршрутизации по политике</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo ip route add local default dev lo table 100 # Добавить таблицу маршрутизации 100
sudo ip rule add fwmark 1 table 100 # Добавить правило для таблицы маршрутизации 100
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="настроика-netfilter" tabindex="-1"><a class="header-anchor" href="#настроика-netfilter"><span>Настройка Netfilter</span></a></h2><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Выберите одну из следующих конфигураций: nftables или iptables. Не используйте обе одновременно.</p></div>`,7),A=n("div",{class:"language-nftables line-numbers-mode","data-ext":"nftables","data-title":"nftables"},[n("pre",{class:"language-nftables"},[n("code",null,`#!/usr/sbin/nft -f

flush ruleset

define RESERVED_IP = {
    10.0.0.0/8,
    100.64.0.0/10,
    127.0.0.0/8,
    169.254.0.0/16,
    172.16.0.0/12,
    192.0.0.0/24,
    224.0.0.0/4,
    240.0.0.0/4,
    255.255.255.255/32
}

table ip xray {
        chain prerouting {
                type filter hook prerouting priority mangle; policy accept;
                ip daddr $RESERVED_IP return
                ip daddr 192.168.0.0/16 tcp dport != 53 return
                ip daddr 192.168.0.0/16 udp dport != 53 return
                ip protocol tcp tproxy to 127.0.0.1:12345 meta mark set 1
                ip protocol udp tproxy to 127.0.0.1:12345 meta mark set 1
        }
        chain output {
                type route hook output priority mangle; policy accept;
                ip daddr $RESERVED_IP return
                ip daddr 192.168.0.0/16 tcp dport != 53 return
                ip daddr 192.168.0.0/16 udp dport != 53 return
                meta mark 2 return
                ip protocol tcp meta mark set 1
                ip protocol udp meta mark set 1
        }
}
`)]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),x=n("div",{class:"custom-container tip"},[n("p",{class:"custom-container-title"},"Использование"),n("p",null,[s("Запишите приведенную выше конфигурацию в файл (например, "),n("code",null,"nft.conf"),s("), затем предоставьте файлу права на выполнение и выполните его от имени пользователя root ( "),n("code",null,"# ./nft.conf"),s(" ).")])],-1),E=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[s("iptables "),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-N"),s(` XRAY
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"10.0"),s(".0.0/8 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"100.64"),s(".0.0/10 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"127.0"),s(".0.0/8 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"169.254"),s(".0.0/16 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"172.16"),s(".0.0/12 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"192.0"),s(".0.0/24 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"224.0"),s(".0.0/4 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"240.0"),s(".0.0/4 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"255.255"),s(".255.255/32 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"192.168"),s(".0.0/16 "),n("span",{class:"token parameter variable"},"-p"),s(" tcp "),n("span",{class:"token operator"},"!"),s(),n("span",{class:"token parameter variable"},"--dport"),s(),n("span",{class:"token number"},"53"),s(),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"192.168"),s(".0.0/16 "),n("span",{class:"token parameter variable"},"-p"),s(" udp "),n("span",{class:"token operator"},"!"),s(),n("span",{class:"token parameter variable"},"--dport"),s(),n("span",{class:"token number"},"53"),s(),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-p"),s(" tcp "),n("span",{class:"token parameter variable"},"-j"),s(" TPROXY --on-port "),n("span",{class:"token number"},"12345"),s(" --tproxy-mark "),n("span",{class:"token number"},"1"),s(`
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY "),n("span",{class:"token parameter variable"},"-p"),s(" udp "),n("span",{class:"token parameter variable"},"-j"),s(" TPROXY --on-port "),n("span",{class:"token number"},"12345"),s(" --tproxy-mark "),n("span",{class:"token number"},"1"),s(`
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" PREROUTING "),n("span",{class:"token parameter variable"},"-j"),s(` XRAY

iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-N"),s(` XRAY_SELF
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"10.0"),s(".0.0/8 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"100.64"),s(".0.0/10 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"127.0"),s(".0.0/8 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"169.254"),s(".0.0/16 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"172.16"),s(".0.0/12 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"192.0"),s(".0.0/24 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"224.0"),s(".0.0/4 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"240.0"),s(".0.0/4 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"255.255"),s(".255.255/32 "),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"192.168"),s(".0.0/16 "),n("span",{class:"token parameter variable"},"-p"),s(" tcp "),n("span",{class:"token operator"},"!"),s(),n("span",{class:"token parameter variable"},"--dport"),s(),n("span",{class:"token number"},"53"),s(),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-d"),s(),n("span",{class:"token number"},"192.168"),s(".0.0/16 "),n("span",{class:"token parameter variable"},"-p"),s(" udp "),n("span",{class:"token operator"},"!"),s(),n("span",{class:"token parameter variable"},"--dport"),s(),n("span",{class:"token number"},"53"),s(),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-m"),s(" mark "),n("span",{class:"token parameter variable"},"--mark"),s(),n("span",{class:"token number"},"2"),s(),n("span",{class:"token parameter variable"},"-j"),s(` RETURN
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-p"),s(" tcp "),n("span",{class:"token parameter variable"},"-j"),s(" MARK --set-mark "),n("span",{class:"token number"},"1"),s(`
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" XRAY_SELF "),n("span",{class:"token parameter variable"},"-p"),s(" udp "),n("span",{class:"token parameter variable"},"-j"),s(" MARK --set-mark "),n("span",{class:"token number"},"1"),s(`
iptables `),n("span",{class:"token parameter variable"},"-t"),s(" mangle "),n("span",{class:"token parameter variable"},"-A"),s(" OUTPUT "),n("span",{class:"token parameter variable"},"-j"),s(` XRAY_SELF
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),T=n("p",null,"После завершения настройки измените шлюз по умолчанию на других устройствах в локальной сети на IP-адрес этого устройства, и они смогут использовать VPN. После того, как вы проверите, что все работает правильно на других хостах и на самом устройстве, перейдите к следующему шагу.",-1),S=n("h2",{id:"настроика-автозагрузки-и-сохранения-конфигурации",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#настроика-автозагрузки-и-сохранения-конфигурации"},[n("span",null,"Настройка автозагрузки и сохранения конфигурации")])],-1),X=n("br",null,null,-1),N=n("p",null,[s("Сначала переместите отредактированный файл конфигурации nftables в каталог "),n("code",null,"/etc"),s(" и переименуйте его в "),n("code",null,"nftables.conf"),s("."),n("br"),s(" Затем отредактируйте файл "),n("code",null,"/lib/systemd/system/nftables.service"),s(".")],-1),Y=n("div",{class:"language-ini line-numbers-mode","data-ext":"ini","data-title":"ini"},[n("pre",{class:"language-ini"},[n("code",null,[n("span",{class:"token section"},[n("span",{class:"token punctuation"},"["),n("span",{class:"token section-name selector"},"Unit"),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"token key attr-name"},"Description"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"nftables"),s(`
`),n("span",{class:"token key attr-name"},"Documentation"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"man:nft(8) http://wiki.nftables.org"),s(`
`),n("span",{class:"token key attr-name"},"Wants"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"network-pre.target"),s(`
`),n("span",{class:"token key attr-name"},"Before"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"network-pre.target shutdown.target"),s(`
`),n("span",{class:"token key attr-name"},"Conflicts"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"shutdown.target"),s(`
`),n("span",{class:"token key attr-name"},"DefaultDependencies"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"no"),s(`

`),n("span",{class:"token section"},[n("span",{class:"token punctuation"},"["),n("span",{class:"token section-name selector"},"Service"),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"token key attr-name"},"Type"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"oneshot"),s(`
`),n("span",{class:"token key attr-name"},"RemainAfterExit"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"yes"),s(`
`),n("span",{class:"token key attr-name"},"StandardInput"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"null"),s(`
`),n("span",{class:"token key attr-name"},"ProtectSystem"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"full"),s(`
`),n("span",{class:"token key attr-name"},"ProtectHome"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"true"),s(`
`),n("span",{class:"token key attr-name"},"ExecStart"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"/usr/sbin/nft -f /etc/nftables.conf ; /usr/sbin/ip route add local default dev lo table 100 ; /usr/sbin/ip rule add fwmark 1 table 100"),s(`
`),n("span",{class:"token key attr-name"},"ExecReload"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"/usr/sbin/nft -f /etc/nftables.conf"),s(`
`),n("span",{class:"token key attr-name"},"ExecStop"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"/usr/sbin/nft flush ruleset ; /usr/sbin/ip route del local default dev lo table 100 ; /usr/sbin/ip rule del table 100"),s(`

`),n("span",{class:"token section"},[n("span",{class:"token punctuation"},"["),n("span",{class:"token section-name selector"},"Install"),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"token key attr-name"},"WantedBy"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"sysinit.target"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),j=n("p",null,[s("Наконец, выполните команду "),n("code",null,"systemctl enable nftables"),s(".")],-1),U=n("p",null,[s("Для сохранения конфигурации iptables рекомендуется установить пакет "),n("code",null,"iptables-persistent"),s(".")],-1),L=n("p",null,[s("Во время установки вам будет предложено сохранить конфигурацию."),n("br"),s(' Если вы уже записали конфигурацию iptables в систему, выберите "Да".'),n("br"),s(" Если вы еще не записали конфигурацию, это не проблема. После установки запишите конфигурацию и выполните команду "),n("code",null,"netfilter-persistent save"),s(" (требуются права root).")],-1),w=n("p",null,[s("Затем отредактируйте файл "),n("code",null,"/lib/systemd/system/netfilter-persistent.service"),s(".")],-1),I=n("div",{class:"language-ini line-numbers-mode","data-ext":"ini","data-title":"ini"},[n("pre",{class:"language-ini"},[n("code",null,[n("span",{class:"token section"},[n("span",{class:"token punctuation"},"["),n("span",{class:"token section-name selector"},"Unit"),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"token key attr-name"},"Description"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"netfilter persistent configuration"),s(`
`),n("span",{class:"token key attr-name"},"DefaultDependencies"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"no"),s(`
`),n("span",{class:"token key attr-name"},"Wants"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"network-pre.target systemd-modules-load.service local-fs.target"),s(`
`),n("span",{class:"token key attr-name"},"Before"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"network-pre.target shutdown.target"),s(`
`),n("span",{class:"token key attr-name"},"After"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"systemd-modules-load.service local-fs.target"),s(`
`),n("span",{class:"token key attr-name"},"Conflicts"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"shutdown.target"),s(`
`),n("span",{class:"token key attr-name"},"Documentation"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"man:netfilter-persistent(8)"),s(`

`),n("span",{class:"token section"},[n("span",{class:"token punctuation"},"["),n("span",{class:"token section-name selector"},"Service"),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"token key attr-name"},"Type"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"oneshot"),s(`
`),n("span",{class:"token key attr-name"},"RemainAfterExit"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"yes"),s(`
`),n("span",{class:"token key attr-name"},"ExecStart"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"/usr/sbin/netfilter-persistent start ; /usr/sbin/ip route add local default dev lo table 100 ; /usr/sbin/ip rule add fwmark 1 table 100"),s(`
`),n("span",{class:"token key attr-name"},"ExecStop"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"/usr/sbin/netfilter-persistent stop ; /usr/sbin/ip route flush dev lo table 100 ; /usr/sbin/ip rule del table 100"),s(`

`),n("span",{class:"token section"},[n("span",{class:"token punctuation"},"["),n("span",{class:"token section-name selector"},"Install"),n("span",{class:"token punctuation"},"]")]),s(`
`),n("span",{class:"token key attr-name"},"WantedBy"),n("span",{class:"token punctuation"},"="),n("span",{class:"token value attr-value"},"multi-user.target"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function P(F,D){const r=p("I18nTip"),o=p("ExternalLinkIcon"),t=p("Tab"),l=p("Tabs");return c(),u("div",null,[v,a(r),n("p",null,[s("Эта конфигурация основана на "),n("a",m,[s("Новом руководстве по V2Ray на русском языке - Прозрачное проксирование (TPROXY)"),a(o)]),s(" с добавлением новых функций Xray, использованием схемы VLESS + XTLS Vision и изменением режима разделения трафика с проксирования по умолчанию на прямое подключение по умолчанию. Пользователи должны настроить конфигурацию в соответствии со своими потребностями.")]),b,q,g,n("p",null,[s("Обратите внимание, что многие руководства по настройке прозрачного проксирования предлагают включить переадресацию IP в системе Linux, но это может привести к снижению производительности Splice. Дополнительную информацию см. в статье "),n("a",y,[s("Расследование снижения производительности Splice до уровня ниже, чем Direct"),a(o)]),s(".")]),f,h,n("p",null,[s("Для лучшего разделения трафика замените файл правил маршрутизации по умолчанию на "),n("a",R,[s("Loyalsoldier/v2ray-rules-dat"),a(o)]),s(", иначе Xray-core не сможет загрузить эту конфигурацию.")]),_,a(l,{title:"netfilter"},{default:e(()=>[a(t,{title:"nftables1"},{default:e(()=>[A,x]),_:1}),a(t,{title:"iptables1"},{default:e(()=>[E]),_:1})]),_:1}),T,S,X,a(l,{title:"netfilter2"},{default:e(()=>[a(t,{title:"nftables2"},{default:e(()=>[N,Y,j]),_:1}),a(t,{title:"iptables2"},{default:e(()=>[U,L,w,I]),_:1})]),_:1})])}const B=i(d,[["render",P],["__file","tproxy.html.vue"]]);export{B as default};
