import{_ as c,r as s,o as r,c as d,a as e,b as t,d as o,w as p,e as n}from"./app-D95a8_-I.js";const u={},h=n(`<h1 id="fallback" tabindex="-1"><a class="header-anchor" href="#fallback"><span>Fallback</span></a></h1><blockquote><p><strong>Fallback is one of the most powerful features of Xray, which can effectively prevent active probing and allows you to use one port for multiple services</strong></p></blockquote><p>Fallback provides Xray with high-strength anti-active probing capabilities and has a unique first-packet fallback mechanism.</p><p>Fallback can also divide traffic of different types based on path for multi-service sharing on a single port.</p><p>Currently, you can use the fallback feature by configuring fallbacks when using VLESS or Trojan protocols, thus creating an unimaginable combo of services becomes REALITY.</p><h2 id="fallbacks-configuration" tabindex="-1"><a class="header-anchor" href="#fallbacks-configuration"><span>fallbacks configuration</span></a></h2><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code>  <span class="token property">&quot;fallbacks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">80</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>fallbacks</code>: [ <a href="#fallbackobject">FallbackObject</a> ]</p></blockquote><p><strong><code>fallbacks</code> is an array, and here is an example configuration of one of its child elements.</strong></p><h3 id="fallbackobject" tabindex="-1"><a class="header-anchor" href="#fallbackobject"><span>FallbackObject</span></a></h3><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;alpn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
  <span class="token property">&quot;xver&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>fallbacks</code> object is optional and can only be used for the <code>TCP+TLS</code> transport combination.</p>`,12),f=e("code",null,"fallbacks",-1),b=e("code",null,'"alpn":["http/1.1"]',-1),m=n('<p>Usually, you need to set up a default fallback with both <code>alpn</code> and <code>path</code> omitted or empty, and then configure other routing rules as needed.</p><p>VLESS will forward traffic with TLS decrypted first packet length &lt;18, invalid protocol version, or failed authentication to the address specified by <code>dest</code>.</p><p>For other transport combinations, you must remove the <code>fallbacks</code> object or all its child elements. At this point, no <code>fallbacks</code> will be enabled, and VLESS will wait until it reads enough data. If the protocol version is invalid or authentication fails, the connection will be terminated directly.</p><blockquote><p><code>name</code>: string</p></blockquote><p>Attempt to match the TLS SNI (Server Name Indication), where an empty value matches any SNI. The default value is <code>&quot;&quot;</code>, which means empty value.</p><blockquote><p><code>alpn</code>: string</p></blockquote><p>Attempt to match the result of TLS ALPN negotiation, where an empty value matches any ALPN result. The default value is <code>&quot;&quot;</code> , which means empty value.</p><p>VLESS will read the TLS ALPN negotiation result only when necessary. If successful, it will output <code>realAlpn =</code> info to the log. Purpose: To solve the problem of Nginx&#39;s inability to simultaneously support http/1.1 and h2c services. Nginx needs to write two lines of listen, one for 1.1 and one for h2c. Note: When <code>&quot;h2&quot;</code> is included in fallbacks alpn, the Inbound TLS needs to be set as <code>&quot;alpn&quot;:[&quot;h2&quot;,&quot;http/1.1&quot;]</code> to support <code>h2</code> access.</p><div class="custom-container tip"><p class="custom-container-title">Tip</p><p>The <code>alpn</code> set in the Fallback is used to match the actual negotiated ALPN, while the <code>alpn</code> set in the Inbound TLS represents the list of optional ALPNs during the handshake. These two have different meanings.</p></div><blockquote><p><code>path</code>: string</p></blockquote><p>Attempt to match the first packet HTTP PATH, where an empty value matches any PATH and a default value is empty. If non-empty, it must start with <code>/</code>, and h2c is not supported.</p><p>Smart: VLESS will only attempt to check the PATH (no more than 55 bytes; the fastest algorithm that does not fully parse HTTP) when necessary. If successful, it will output <code>realPath =</code> in the INFO log. Purpose: To route other inbound WebSocket traffic or HTTP disguised traffic, without additional processing, purely forwarding traffic, and theoretically better performance than Nginx.</p><p>Note: <strong>The inbound where fallbacks is located must be TCP+TLS</strong>. This is for routing to other WebSocket inbound, while the inbound being routed doesn&#39;t need to configure TLS.</p><blockquote><p><code>dest</code>: string | number</p></blockquote><p>Determines the destination of decrypted TLS TCP traffic, which currently supports two types of addresses: (this field is required, otherwise it cannot be started)</p>',15),k=e("li",null,[t("TCP, in the format of "),e("code",null,'"addr:port"'),t(", where addr supports IPv4, domain names, and IPv6. If a domain name is entered, a direct TCP connection will be made (rather than using the built-in DNS resolver).")],-1),g=e("code",null,'"/dev/shm/domain.socket"',-1),v=e("code",null,"@",-1),_={href:"https://www.man7.org/linux/man-pages/man7/unix.7.html",target:"_blank",rel:"noopener noreferrer"},y=e("code",null,"@@",-1),w=e("p",null,[t("If only the port is specified, both numbers and strings are accepted, such as "),e("code",null,"80"),t(" or "),e("code",null,'"80"'),t(". This usually points to a plaintext HTTP service (and the addr will be filled in as "),e("code",null,'"127.0.0.1"'),t(").")],-1),q=e("blockquote",null,[e("p",null,[e("code",null,"xver"),t(": number")])],-1),T={href:"https://www.haproxy.org/download/2.2/doc/proxy-protocol.txt",target:"_blank",rel:"noopener noreferrer"},x=e("code",null,"1",-1),P=e("code",null,"2",-1),S=e("code",null,"0",-1),L=e("code",null,"1",-1),I=n("<p>Currently, versions <code>1</code> and <code>2</code> have the same functionality but different structures, where version <code>1</code> is printable while version 2 is <code>binary</code>. Xray&#39;s <code>TCP</code> and <code>WebSocket</code> inbound already support receiving the PROXY protocol.</p>",1),N={class:"custom-container warning"},A=e("p",{class:"custom-container-title"},"Warning",-1),j={href:"https://docs.nginx.com/nginx/admin-guide/load-balancer/using-proxy-protocol/#configuring-nginx-to-accept-the-proxy-protocol",target:"_blank",rel:"noopener noreferrer"},F=e("code",null,"proxy_protocol",-1),C=e("code",null,"set_real_ip_from",-1),V=n('<h3 id="additional-information" tabindex="-1"><a class="header-anchor" href="#additional-information"><span>Additional Information</span></a></h3><ul><li>Matches the most precise sub-element, regardless of the order of arrangement of the sub-elements. If several sub-elements have the same <code>alpn</code> and <code>path</code> configurations, the last one specified will be used.</li><li>Fallback routing is performed at the decrypted TCP layer rather than the HTTP layer, and the first packet PATH is only checked when necessary.</li><li>You can learn more about tips and experiences in using Fallbacks by visiting <ul><li><a href="../../document/level-1/fallbacks-lv1">An Analysis of Fallback Functionality.</a></li></ul></li></ul>',2),E={id:"fallbacks-design-theory",tabindex:"-1"},H={class:"header-anchor",href:"#fallbacks-design-theory"};function O(R,W){const l=s("RouterLink"),a=s("ExternalLinkIcon"),i=s("Badge");return r(),d("div",null,[h,e("ul",null,[e("li",null,[t("When "),f,t(" configure with any child elementsï¼Œ"),b,t(" needs to be configured in "),o(l,{to:"/en/config/transport.html#tlsobject"},{default:p(()=>[t("Inbound TLS")]),_:1}),t(".")])]),m,e("ol",null,[k,e("li",null,[t("Unix domain socket, in the format of an absolute path, such as "),g,t(", which can be prefixed with "),v,t(" to represent "),e("a",_,[t("abstract"),o(a)]),t(", and "),y,t(" to represent padded abstract.")])]),w,q,e("p",null,[t("Sends the "),e("a",T,[t("PROXY protocol"),o(a)]),t(" protocol, which is used to transmit the real source IP and port of the request. The version can be set to "),x,t(" or "),P,t(", with a default value of "),S,t(", which means no PROXY protocol is sent. Version "),L,t(" is recommended if needed.")]),I,e("div",N,[A,e("p",null,[t("If you are "),e("a",j,[t("configuring Nginx to receive the PROXY protocol"),o(a)]),t(", you need to not only set "),F,t(", but also "),C,t(" to avoid potential issues.")])]),V,e("h2",E,[e("a",H,[e("span",null,[t("Fallbacks design theory "),o(i,{text:"WIP",type:"warning"})])])])])}const Y=c(u,[["render",O],["__file","fallback.html.vue"]]);export{Y as default};
