import{_ as l,r as t,o as c,c as u,a,b as s,d as n,w as p,e as i}from"./app-BQbqCP-9.js";const d={},v=s("h1",{id:"api",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#api"},[s("span",null,"API")])],-1),k={href:"https://grpc.io/",target:"_blank",rel:"noopener noreferrer"},b=s("br",null,null,-1),h=s("br",null,null,-1),m=s("a",{href:"#%D1%81%D0%B2%D1%8F%D0%B7%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8"},"Связанные настройки",-1),g={href:"https://github.com/XTLS/Xray-core/releases/tag/v1.8.12",target:"_blank",rel:"noopener noreferrer"},q=s("br",null,null,-1),D=i(`<div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Большинству пользователей не нужен этот API, новички могут просто пропустить этот раздел.</p></div><h2 id="apiobject" tabindex="-1"><a class="header-anchor" href="#apiobject"><span>ApiObject</span></a></h2><p><code>ApiObject</code> соответствует полю <code>api</code> в конфигурационном файле.</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;listen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1:8080&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;services&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;HandlerService&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;LoggerService&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;StatsService&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;RoutingService&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>tag</code>: string</p></blockquote><p>Тег исходящего подключения.</p><blockquote><p><code>listen</code>: string</p></blockquote><p>IP-адрес и порт, на котором прослушивает API-сервер. Это необязательный параметр.</p><p>Если этот параметр опущен, необходимо добавить настройки inbounds и routing, как показано в примере в разделе <a href="#%D1%81%D0%B2%D1%8F%D0%B7%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8">Связанные настройки</a>.</p><blockquote><p><code>services</code>: [string]</p></blockquote><p>Список включенных API.<br> Доступные значения см. в разделе <a href="#%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA-%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D0%B2%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-api">Список API</a>.</p><h2 id="связанные-настроики" tabindex="-1"><a class="header-anchor" href="#связанные-настроики"><span>Связанные настройки</span></a></h2><p>Можно добавить входящее подключение api в раздел inbounds:</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;listen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">10085</span><span class="token punctuation">,</span>
    <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dokodemo-door&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Добавить правило маршрутизации для входящего подключения api в раздел routing:</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token property">&quot;routing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;inboundTag&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;api&quot;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Добавить api в основные настройки:</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token property">&quot;api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;services&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;StatsService&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="список-поддерживаемых-api" tabindex="-1"><a class="header-anchor" href="#список-поддерживаемых-api"><span>Список поддерживаемых API</span></a></h2><h3 id="handlerservice" tabindex="-1"><a class="header-anchor" href="#handlerservice"><span>HandlerService</span></a></h3><p>API для изменения входящих и исходящих подключений.<br> Доступны следующие функции:</p><ul><li>Добавление нового входящего подключения;</li><li>Добавление нового исходящего подключения;</li><li>Удаление существующего входящего подключения;</li><li>Удаление существующего исходящего подключения;</li><li>Добавление пользователя к входящему подключению (поддерживается только для VMess, VLESS, Trojan, Shadowsocks (v1.3.0+));</li><li>Удаление пользователя из входящего подключения (поддерживается только для VMess, VLESS, Trojan, Shadowsocks (v1.3.0+));</li></ul><h3 id="routingservice" tabindex="-1"><a class="header-anchor" href="#routingservice"><span>RoutingService</span></a></h3><p>API для добавления, удаления, замены правил маршрутизации и запроса статистики балансировщика.<br> Доступны следующие функции:</p><ul><li>adrules - добавление или замена правил маршрутизации;</li><li>rmrules - удаление правил маршрутизации;</li><li>sib - разрыв соединений с указанного IP-адреса;</li><li>bi - запрос статистики балансировщика;</li><li>bo - принудительное переключение балансировщика на указанный outboundTag.</li></ul><p>Конкретное использование можно узнать с помощью команды <code>./xray help api bi</code>.</p><h3 id="loggerservice" tabindex="-1"><a class="header-anchor" href="#loggerservice"><span>LoggerService</span></a></h3><p>Поддержка перезапуска встроенного логгера.<br> Можно использовать совместно с logrotate для управления файлами журналов.</p><h3 id="statsservice" tabindex="-1"><a class="header-anchor" href="#statsservice"><span>StatsService</span></a></h3>`,29),B=s("br",null,null,-1),_=i(`<h3 id="reflectionservice" tabindex="-1"><a class="header-anchor" href="#reflectionservice"><span>ReflectionService</span></a></h3><p>Позволяет gRPC-клиентам получать список API сервера.</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ grpcurl <span class="token parameter variable">-plaintext</span> localhost:10085 list
grpc.reflection.v1alpha.ServerReflection
v2ray.core.app.proxyman.command.HandlerService
v2ray.core.app.stats.command.StatsService
xray.app.proxyman.command.HandlerService
xray.app.stats.command.StatsService
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="примеры-вызова-api" tabindex="-1"><a class="header-anchor" href="#примеры-вызова-api"><span>Примеры вызова API</span></a></h2>`,4),f={href:"https://github.com/XTLS/Xray-API-documents",target:"_blank",rel:"noopener noreferrer"};function y(S,x){const r=t("I18nTip"),e=t("ExternalLinkIcon"),o=t("RouterLink");return c(),u("div",null,[a(r),v,s("p",null,[n("Настройка API предоставляет API-интерфейсы на основе "),s("a",k,[n("gRPC"),a(e)]),n(" для удаленного вызова.")]),s("p",null,[n("Интерфейсы можно включить с помощью модуля конфигурации api. Когда API включен, Xray создает исходящее подключение с тем же тегом, что и тег API."),b,n(" Необходимо вручную направить все входящие API-подключения на это исходящее подключение с помощью "),a(o,{to:"/ru/config/routing.html"},{default:p(()=>[n("правил маршрутизации")]),_:1}),n("."),h,n(" См. раздел "),m,n(" в этом документе.")]),s("p",null,[n("Начиная с версии "),s("a",g,[n("v1.8.12"),a(e)]),n(" поддерживается упрощенный режим настройки, в котором достаточно указать только ApiObject, без необходимости настройки inbounds и routing."),q,n(" Однако при использовании упрощенной настройки статистика трафика не учитывает трафик входящих API-подключений.")]),D,s("p",null,[n("Встроенная служба статистики данных."),B,n(" См. "),a(o,{to:"/ru/config/stats.html"},{default:p(()=>[n("Статистика")]),_:1}),n(".")]),_,s("p",null,[s("a",f,[n("Xray-API-documents"),a(e)]),n(" @crossfw")])])}const I=l(d,[["render",y],["__file","api.html.vue"]]);export{I as default};
