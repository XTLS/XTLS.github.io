import{_ as t,r as o,o as i,c as r,a as e,b as a,d as s,e as c}from"./app-CKHIb5kb.js";const p={},d=a("h1",{id:"документация-по-сборке",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#документация-по-сборке"},[a("span",null,"Документация по сборке")])],-1),u=a("h2",{id:"подготовка",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#подготовка"},[a("span",null,"Подготовка")])],-1),h={href:"https://golang.org/",target:"_blank",rel:"noopener noreferrer"},v={class:"custom-container tip"},m=a("p",{class:"custom-container-title"},"СОВЕТ",-1),b={href:"https://golang.org/doc/install",target:"_blank",rel:"noopener noreferrer"},g=c(`<blockquote><p>Если вы, к сожалению, используете Windows, <strong>обязательно</strong> используйте Powershell.</p></blockquote><h2 id="получение-исходного-кода-xray" tabindex="-1"><a class="header-anchor" href="#получение-исходного-кода-xray"><span>Получение исходного кода Xray</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/XTLS/Xray-core.git
<span class="token builtin class-name">cd</span> Xray-core <span class="token operator">&amp;&amp;</span> go mod download
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Если вам нечем заняться, можете попробовать официальный инструмент GitHub: <code>gh repo clone XTLS/Xray-core</code>.</p></blockquote><p>Примечание: в сетевых средах, где нет доступа к Google, зависимости не могут быть получены обычным способом, поэтому необходимо сначала установить <code>GOPROXY</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.io,direct
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="сборка-бинарного-фаила" tabindex="-1"><a class="header-anchor" href="#сборка-бинарного-фаила"><span>Сборка бинарного файла</span></a></h2><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Команды в этом разделе необходимо выполнять в корневом каталоге Xray.</p></div><h3 id="windows-powershell" tabindex="-1"><a class="header-anchor" href="#windows-powershell"><span>Windows (Powershell):</span></a></h3><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token variable">$env</span>:CGO_ENABLED=0
go build <span class="token operator">-</span>o xray<span class="token punctuation">.</span>exe <span class="token operator">-</span>trimpath <span class="token operator">-</span>ldflags <span class="token string">&quot;-s -w -buildid=&quot;</span> <span class="token punctuation">.</span><span class="token operator">/</span>main
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="macos-linux" tabindex="-1"><a class="header-anchor" href="#macos-linux"><span>macOS, Linux:</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> go build <span class="token parameter variable">-o</span> xray <span class="token parameter variable">-trimpath</span> <span class="token parameter variable">-ldflags</span> <span class="token string">&quot;-s -w -buildid=&quot;</span> ./main
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Выполнение этих команд создаст исполняемый файл xray в текущем каталоге.</p><div class="custom-container tip"><p class="custom-container-title">Подсказка</p><p>Если вам нужно собрать программу с поддержкой отладки, то есть такую, к которой можно подключиться с помощью dlv для отладки, удалите опции &#39;-w -s&#39; из ldflags.</p><p>-w отключает генерацию отладочной информации. Если эта опция используется, отладка с помощью gdb будет невозможна. -s отключает таблицу символов. P.S.: На самом деле отладка с помощью vscode или другой IDE может быть более удобной.</p></div><h2 id="кросс-компиляция" tabindex="-1"><a class="header-anchor" href="#кросс-компиляция"><span>Кросс-компиляция:</span></a></h2><p>В качестве примера рассмотрим компиляцию в среде Windows (Powershell) для сервера Linux:</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token variable">$env</span>:CGO_ENABLED=0
<span class="token variable">$env</span>:GOOS=<span class="token string">&quot;linux&quot;</span>
<span class="token variable">$env</span>:GOARCH=<span class="token string">&quot;amd64&quot;</span>

go build <span class="token operator">-</span>o xray <span class="token operator">-</span>trimpath <span class="token operator">-</span>ldflags <span class="token string">&quot;-s -w -buildid=&quot;</span> <span class="token punctuation">.</span><span class="token operator">/</span>main
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>После загрузки на сервер не забудьте выполнить команду <code>chmod +x xray</code> в терминале сервера.</p><div class="custom-container tip"><p class="custom-container-title">Подсказка</p><p>Выполните команду <code>go tool dist list</code>, чтобы просмотреть все поддерживаемые системы и архитектуры.</p></div><h2 id="воспроизводимая-сборка" tabindex="-1"><a class="header-anchor" href="#воспроизводимая-сборка"><span>Воспроизводимая сборка:</span></a></h2><p>Выполнив описанные выше шаги, вы можете собрать бинарный файл, идентичный тому, что находится в релизе.</p><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Убедитесь, что вы используете ту же версию Golang, что и для сборки релиза.</p></div>`,22);function k(_,x){const l=o("I18nTip"),n=o("ExternalLinkIcon");return i(),r("div",null,[e(l),d,u,a("p",null,[s("Xray использует "),a("a",h,[s("Golang"),e(n)]),s(" в качестве языка программирования, поэтому вам необходимо сначала установить последнюю версию Golang, чтобы иметь возможность выполнить сборку.")]),a("div",v,[m,a("p",null,[s("Установка Golang: "),a("a",b,[s("golang.org/doc/install"),e(n)])])]),g])}const f=t(p,[["render",k],["__file","compile.html.vue"]]);export{f as default};
