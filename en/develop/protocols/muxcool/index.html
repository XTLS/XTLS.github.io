<!doctype html><html><head><title>Mux.Cool 协议 :: Project X</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2021-04-04T11:51:16 UTC"><meta name=description content="Project X 的文档."><meta name=author content="Project X"><title>Mux.Cool 协议 :: Project X</title><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/layout.css><link rel=stylesheet type=text/css href=https://xtls.github.io/css/style.main.css><link rel=stylesheet type=text/css href=https://xtls.github.io/css/style.menu.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/notice.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/tabs.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/panel.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/columns.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/children.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/attachments.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/alert.css><link rel=stylesheet type=text/css href=/css/docport.css><script src=/js/docport.js></script><script type=text/javascript>var baseurl="https://xtls.github.io"</script><link rel=stylesheet href=/css/custom.css></head><body data-url=/en/develop/protocols/muxcool/><style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style><header><div><div class=burger><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">&#9776;</a></div><div><a class=baselink href=https://xtls.github.io>Project X</a></div><nav class=shortcuts><li role><a href=/about/new rel=noopener>What's New</a></li><li role><a href=https://github.com/XTLS rel=noopener>GitHub</a></li><li role><a href=https://github.com/XTLS/Xray-core/releases rel=noopener>Download</a></li><li role><a href=https://xtls.github.io/ rel=noopener>Documentation</a></li></nav></div></header><article><aside><div class=search><div class=searchbox><input data-search-input id=search-by type=text placeholder="Type to search..."></div><script type=text/javascript src=/vendor/lunr/lunr.min.js></script><script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script><link href=/vendor/auto-complete/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https://xtls.github.io/en"</script><script type=text/javascript src=/js/search.js></script></div><center><a class=github-button href=https://github.com/XTLS/Xray-core/releases data-icon=octicon-cloud-download aria-label="Download vjeantet/hugo-theme-docport on GitHub">Download</a>
<a class=github-button href=https://github.com/XTLS/Xray-core data-icon=octicon-star data-show-count=false aria-label="Star vjeantet/hugo-theme-docport on GitHub">Star</a>
<a class=github-button href=https://github.com/XTLS/Xray-core/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork vjeantet/hugo-theme-docport on GitHub">Fork</a></center>
<script async defer src=https://buttons.github.io/buttons.js></script><div id=close_menu><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')"><i class="fa fa-lg fa-times"></i></a></div><ul class=menu><hr><li data-nav-id=https://xtls.github.io/en/about/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i>
<a href=/en/about/>Project X&nbsp;⚡</a><ul><li data-nav-id=https://xtls.github.io/en/about/new/ class="dd-item
item_level_$level"><a href=/en/about/new/>X History&nbsp;</a></li></ul></li><hr><li data-nav-id=https://xtls.github.io/en/guide/ class="dd-item alwaysopen
item_level_$level"><a href=/en/guide/>Quick start&nbsp;</a></li><li data-nav-id=https://xtls.github.io/en/config/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i>
<a href=/en/config/>Configuration files&nbsp;📜</a><ul><li data-nav-id=https://xtls.github.io/en/config/base/ class="dd-item haschildren
item_level_$level"><a href=/en/config/base/>Basic configuration module&nbsp;</a>
<i class="fas fa-chevron-right ddexp"></i><ul><li data-nav-id=https://xtls.github.io/en/config/base/log/ class="dd-item
item_level_$level"><a href=/en/config/base/log/>日志配置</a></li><li data-nav-id=https://xtls.github.io/en/config/base/api/ class="dd-item
item_level_$level"><a href=/en/config/base/api/>API interfaces</a></li><li data-nav-id=https://xtls.github.io/en/config/base/dns/ class="dd-item
item_level_$level"><a href=/en/config/base/dns/>Built-in dns server</a></li><li data-nav-id=https://xtls.github.io/en/config/base/routing/ class="dd-item
item_level_$level"><a href=/en/config/base/routing/>Routing</a></li><li data-nav-id=https://xtls.github.io/en/config/base/policy/ class="dd-item
item_level_$level"><a href=/en/config/base/policy/>本地策略</a></li><li data-nav-id=https://xtls.github.io/en/config/base/inbounds/ class="dd-item
item_level_$level"><a href=/en/config/base/inbounds/>Inbounds</a></li><li data-nav-id=https://xtls.github.io/en/config/base/outbounds/ class="dd-item
item_level_$level"><a href=/en/config/base/outbounds/>Outbounds</a></li><li data-nav-id=https://xtls.github.io/en/config/base/transport/ class="dd-item
item_level_$level"><a href=/en/config/base/transport/>传输方式</a></li><li data-nav-id=https://xtls.github.io/en/config/base/stats/ class="dd-item
item_level_$level"><a href=/en/config/base/stats/>统计信息</a></li><li data-nav-id=https://xtls.github.io/en/config/base/reverse/ class="dd-item
item_level_$level"><a href=/en/config/base/reverse/>反向代理</a></li></ul></li><li data-nav-id=https://xtls.github.io/en/config/inbound-protocols/ class="dd-item
item_level_$level"><a href=/en/config/inbound-protocols/>Inbounds 可用协议列表</a></li><li data-nav-id=https://xtls.github.io/en/config/outbound-protocols/ class="dd-item
item_level_$level"><a href=/en/config/outbound-protocols/>Outbounds 可用协议列表</a></li><li data-nav-id=https://xtls.github.io/en/config/transports/ class="dd-item
item_level_$level"><a href=/en/config/transports/>传输方式列表</a></li><li data-nav-id=https://xtls.github.io/en/config/fallback/ class="dd-item
item_level_$level"><a href=/en/config/fallback/>Fallbacks</a></li><li data-nav-id=https://xtls.github.io/en/config/xtls/ class="dd-item
item_level_$level"><a href=/en/config/xtls/>XTLS</a></li><li data-nav-id=https://xtls.github.io/en/config/env/ class="dd-item
item_level_$level"><a href=/en/config/env/>Environment Variables</a></li><li data-nav-id=https://xtls.github.io/en/config/multiple_config/ class="dd-item alwaysopen
item_level_$level"><a href=/en/config/multiple_config/>多文件配置</a></li></ul></li><li data-nav-id=https://xtls.github.io/en/documents/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i>
<a href=/en/documents/>Using Experiences&nbsp;📚</a><ul><li data-nav-id=https://xtls.github.io/en/documents/level-0/ class="dd-item alwaysopen
item_level_$level"><a href=/en/documents/level-0/>小小白白话文&nbsp;📙</a></li><li data-nav-id=https://xtls.github.io/en/documents/level-1/ class="dd-item alwaysopen
item_level_$level"><a href=/en/documents/level-1/>Getting Started Skills&nbsp;</a></li><li data-nav-id=https://xtls.github.io/en/documents/level-2/ class="dd-item alwaysopen
item_level_$level"><a href=/en/documents/level-2/>Advanced Documentation&nbsp;📘</a></li></ul></li><li data-nav-id=https://xtls.github.io/en/develop/ class="dd-item parent haschildren
item_level_$level"><i class="fas fa-chevron-down ddexp"></i>
<a href=/en/develop/>开发指南&nbsp;🖥️</a><ul><li data-nav-id=https://xtls.github.io/en/develop/intro/ class="dd-item alwaysopen
item_level_$level"><a href=/en/develop/intro/>开发手册</a></li><li data-nav-id=https://xtls.github.io/en/develop/protocols/ class="dd-item parent active alwaysopen
item_level_$level"><a href=/en/develop/protocols/>协议详解</a></li></ul></li><li data-nav-id=https://xtls.github.io/en/faq/ class="dd-item alwaysopen
item_level_$level"><a href=/en/faq/>常见问答&nbsp;💬</a></li><li data-nav-id=https://xtls.github.io/en/caseslip/ class="dd-item alwaysopen
item_level_$level"><a href=/en/caseslip/>大案牍术&nbsp;</a></li><hr><li data-nav-id=https://xtls.github.io/en/links/ class="dd-item alwaysopen
item_level_$level"><a href=/en/links/>常用链接&nbsp;🤝</a></li></ul></aside><section class=page><nav id=ariane aria-label=breadcrumb><ol class=ariane><li><a class=text-link href=https://xtls.github.io>Home</a></li><li><a class=text-link href=/en/develop/>开发指南</a></li><li><a class=text-link href=/en/develop/protocols/>协议详解</a></li><li class=active>Mux.Cool 协议</li></ol></nav><h1>协议详解<span>Mux.Cool 协议</span></h1><nav class=subpages><li><a title=$pagetitle href=/en/develop/protocols/vless/>VLESS 协议</a></li><li><a title=$pagetitle href=/en/develop/protocols/vmess/>VMess 协议</a></li><li class=active><a title=$pagetitle href=/en/develop/protocols/muxcool/>Mux.Cool 协议</a></li><li><a title=$pagetitle href=/en/develop/protocols/mkcp/>mKCP 协议</a></li></nav><div class=jump-to-section><span onclick="$h=$(this),$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right'})})"><span class="fas fa-align-right"></span>Jump to Section
<i class="fas fa-chevron-right"></i></span><nav id=TableOfContents><ul><li><a href=#版本>版本</a></li><li><a href=#依赖>依赖</a><ul><li><a href=#底层协议>底层协议</a></li></ul></li><li><a href=#通讯过程>通讯过程</a><ul><li><a href=#客户端行为>客户端行为</a></li><li><a href=#服务器端行为>服务器端行为</a></li></ul></li><li><a href=#传输格式>传输格式</a><ul><li><a href=#帧格式>帧格式</a></li><li><a href=#元数据>元数据</a></li><li><a href=#新建子连接-new>新建子连接 (New)</a></li><li><a href=#保持子连接-keep>保持子连接 (Keep)</a></li><li><a href=#关闭子连接-end>关闭子连接 (End)</a></li><li><a href=#保持连接-keepalive>保持连接 (KeepAlive)</a></li></ul></li><li><a href=#应用>应用</a></li></ul></nav></div><div class=content><p>Mux.Cool 协议是一个多路复用传输协议，用于在一条已建立的数据流中传输多个各自独立的数据流。</p><p><br></p><h2 ref=版本>版本</h2><a class=anchor id=版本></a><hr><p>当前版本是 1 Beta。</p><p><br></p><h2 ref=依赖>依赖</h2><a class=anchor id=依赖></a><hr><h3 ref=底层协议>底层协议</h3><a class=anchor id=底层协议></a><hr><p>Mux.Cool 必须运行在一个已建立的可靠数据流之上。</p><p><br></p><h2 ref=通讯过程>通讯过程</h2><a class=anchor id=通讯过程></a><hr><p>一个 Mux.Cool 连接中可传输若干个子连接，每个子连接有一个独立的 ID 和状态。传输过程由帧（Frame）组成，每一帧用于传输一个特定的子连接的数据。</p><p><br></p><h3 ref=客户端行为>客户端行为</h3><a class=anchor id=客户端行为></a><hr><p>当有连接需求时并且没有现有可用的连接时，客户端向服务器发起一个新连接，以下称为“主连接”。</p><ol><li>一个主连接可用于发送若干个子连接。客户端可自主决定主连接可承载的子连接数量。</li><li>对于一个新的子连接，客户端必须发送状态<code>New</code>以通知服务器建立子连接，然后使用状态<code>Keep</code>来传送数据。</li><li>当子连接结束时，客户端发送<code>End</code>状态来通知服务器关闭子连接。</li><li>客户端可自行决定何时关闭主连接，但必须确定服务器也同时保持连接。</li><li>客户端可使用 KeepAlive 状态来避免服务器关闭主连接。</li></ol><p><br></p><h3 ref=服务器端行为>服务器端行为</h3><a class=anchor id=服务器端行为></a><hr><p>当服务器端接收到新的子连接时，服务器应当按正常的连接来处理。</p><ol><li>当收到状态<code>End</code>时，服务器端可以关闭对目标地址的上行连接。</li><li>在服务器的响应中，必须使用与请求相同的 ID 来传输子连接的数据。</li><li>服务器不能使用<code>New</code>状态。</li><li>服务器可使用 KeepAlive 状态来避免客户端关闭主连接。</li></ol><p><br></p><h2 ref=传输格式>传输格式</h2><a class=anchor id=传输格式></a><hr><p>Mux.Cool 使用对称传输格式，即客户端和服务器发送和接收相同格式的数据。</p><p><br></p><h3 ref=帧格式>帧格式</h3><a class=anchor id=帧格式></a><hr><table><thead><tr><th>2 字节</th><th>L 字节</th><th>X 字节</th></tr></thead><tbody><tr><td>元数据长度 L</td><td>元数据</td><td>额外数据</td></tr></tbody></table><p><br></p><h3 ref=元数据>元数据</h3><a class=anchor id=元数据></a><hr><p>元数据有若干种类型，由状态 S 来区分。所有类型的元数据都包含 ID 和 Opt 两项，其含义为：</p><ul><li>ID: 子连接的唯一标识</li><li>Opt:<ul><li>D(0x01): 有额外数据</li></ul></li></ul><p>当选项 Opt(D) 开启时，额外数据格式如下：</p><table><thead><tr><th>2 字节</th><th>L 字节</th></tr></thead><tbody><tr><td>长度 L</td><td>数据</td></tr></tbody></table><p><br></p><h3 ref=新建子连接-new>新建子连接 (New)</h3><a class=anchor id=新建子连接-new></a><hr><table><thead><tr><th>2 字节</th><th>1 字节</th><th>1 字节</th><th>1 字节</th><th>2 字节</th><th>1 字节</th><th>X 字节</th></tr></thead><tbody><tr><td>ID</td><td>0x01</td><td>选项 Opt</td><td>网络类型 N</td><td>端口</td><td>地址类型 T</td><td>地址 A</td></tr></tbody></table><p>其中：</p><ul><li>网络类型 N：<ul><li>0x01：TCP，表示当前子连接的流量应当以 TCP 的方式发送至目标。</li><li>0x02：UDP，表示当前子连接的流量应当以 UDP 的方式发送至目标。</li></ul></li><li>地址类型 T：<ul><li>0x01：IPv4</li><li>0x02：域名</li><li>0x03：IPv6</li></ul></li><li>地址 A：<ul><li>当 T = 0x01 时，A 为 4 字节 IPv4 地址；</li><li>当 T = 0x02 时，A 为 1 字节长度（L） + L 字节域名；</li><li>当 T = 0x03 时，A 为 16 字节 IPv6 地址；</li></ul></li></ul><p>在新建子连接时，若 Opt(D) 开启，则这一帧所带的数据需要被发往目标主机。</p><p><br></p><h3 ref=保持子连接-keep>保持子连接 (Keep)</h3><a class=anchor id=保持子连接-keep></a><hr><table><thead><tr><th>2 字节</th><th>1 字节</th><th>1 字节</th></tr></thead><tbody><tr><td>ID</td><td>0x02</td><td>选项 Opt</td></tr></tbody></table><p>在保持子连接时，若 Opt(D) 开启，则这一帧所带的数据需要被发往目标主机。</p><p><br></p><h3 ref=关闭子连接-end>关闭子连接 (End)</h3><a class=anchor id=关闭子连接-end></a><hr><table><thead><tr><th>2 字节</th><th>1 字节</th><th>1 字节</th></tr></thead><tbody><tr><td>ID</td><td>0x03</td><td>选项 Opt</td></tr></tbody></table><p>在保持子连接时，若 Opt(D) 开启，则这一帧所带的数据需要被发往目标主机。</p><p><br></p><h3 ref=保持连接-keepalive>保持连接 (KeepAlive)</h3><a class=anchor id=保持连接-keepalive></a><hr><table><thead><tr><th>2 字节</th><th>1 字节</th><th>1 字节</th></tr></thead><tbody><tr><td>ID</td><td>0x04</td><td>选项 Opt</td></tr></tbody></table><p>在保持连接时:</p><ul><li>若 Opt(D) 开启，则这一帧所带的数据必须被丢弃。</li><li>ID 可为随机值。</li></ul><p><br></p><h2 ref=应用>应用</h2><a class=anchor id=应用></a><hr><p>Mux.Cool 协议与底层协议无关，理论上可以使用任何可靠的流式连接来传输 Mux.Cool 的协议数据。</p><p>在目标导向的协议如 Shadowsocks 和 VMess 协议中，连接建立时必须包含一个指定的地址。<br>为了保持兼容性，Mux.Cool 协议指定地址为“v1.mux.cool”。即当主连接的目标地址与之匹配时，则进行 Mux.Cool 方式的转发，否则按传统方式进行转发。</p></div><div class=chevrons></div></section><section class=right-menu><div class=TableOfContents><label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What's on this page</label><nav><ul><li><a href=/en/develop/protocols/muxcool/>Mux.Cool 协议</a></li></ul></nav><nav id=TableOfContents><ul><li><a href=#版本>版本</a></li><li><a href=#依赖>依赖</a><ul><li><a href=#底层协议>底层协议</a></li></ul></li><li><a href=#通讯过程>通讯过程</a><ul><li><a href=#客户端行为>客户端行为</a></li><li><a href=#服务器端行为>服务器端行为</a></li></ul></li><li><a href=#传输格式>传输格式</a><ul><li><a href=#帧格式>帧格式</a></li><li><a href=#元数据>元数据</a></li><li><a href=#新建子连接-new>新建子连接 (New)</a></li><li><a href=#保持子连接-keep>保持子连接 (Keep)</a></li><li><a href=#关闭子连接-end>关闭子连接 (End)</a></li><li><a href=#保持连接-keepalive>保持连接 (KeepAlive)</a></li></ul></li><li><a href=#应用>应用</a></li></ul></nav></div><div class=Actions><nav><ul><li><a href=https://github.com/XTLS/XTLS.github.io/tree/main/content/develop/protocols/muxcool.md target=blank><i class="fab fa-github"></i>
Improve this page</a></li><li><i class="fas fa-calendar"></i>
Last update on 23 December 2020</li></ul></nav></div></section></article><footer><footer><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/stack><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/XTLS><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020-2021 ProjectX Community All Rights Reserved</small></div></div></div></footer></footer></body></html>