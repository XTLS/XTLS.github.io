<!doctype html><html><head><title>开发规范 :: Project X</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2021-03-11T06:35:35 UTC"><meta name=description content="Project X 的文档."><meta name=author content="Project X"><title>开发规范 :: Project X</title><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/layout.css><link rel=stylesheet type=text/css href=https://xtls.github.io/css/style.main.css><link rel=stylesheet type=text/css href=https://xtls.github.io/css/style.menu.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/notice.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/tabs.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/panel.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/columns.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/children.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/attachments.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/alert.css><link rel=stylesheet type=text/css href=/css/docport.css><script src=/js/docport.js></script><script type=text/javascript>var baseurl="https://xtls.github.io"</script><link rel=stylesheet href=/css/custom.css></head><body data-url=/develop/intro/guide/><style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style><header><div><div class=burger><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">&#9776;</a></div><div><a class=baselink href=https://xtls.github.io>Project X</a></div><nav class=shortcuts><li role><a href=/about/new rel=noopener>What's New</a></li><li role><a href=https://github.com/XTLS rel=noopener>GitHub</a></li><li role><a href=https://github.com/XTLS/Xray-core/releases rel=noopener>Download</a></li><li role><a href=https://xtls.github.io/ rel=noopener>Documentation</a></li></nav></div></header><article><aside><div class=search><div class=searchbox><input data-search-input id=search-by type=text placeholder></div><script type=text/javascript src=/vendor/lunr/lunr.min.js></script><script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script><link href=/vendor/auto-complete/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https://xtls.github.io"</script><script type=text/javascript src=/js/search.js></script></div><center><a class=github-button href=https://github.com/XTLS/Xray-core/releases data-icon=octicon-cloud-download aria-label="Download vjeantet/hugo-theme-docport on GitHub">Download</a>
<a class=github-button href=https://github.com/XTLS/Xray-core data-icon=octicon-star data-show-count=false aria-label="Star vjeantet/hugo-theme-docport on GitHub">Star</a>
<a class=github-button href=https://github.com/XTLS/Xray-core/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork vjeantet/hugo-theme-docport on GitHub">Fork</a></center>
<script async defer src=https://buttons.github.io/buttons.js></script><div id=close_menu><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')"><i class="fa fa-lg fa-times"></i></a></div><ul class=menu><hr><li data-nav-id=https://xtls.github.io/about/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/about/>Project X&nbsp;⚡</a><ul><li data-nav-id=https://xtls.github.io/about/new/ class="dd-item
item_level_$level"><a href=/about/new/>大史记&nbsp;</a></li></ul></li><hr><li data-nav-id=https://xtls.github.io/guide/ class="dd-item alwaysopen
item_level_$level"><a href=/guide/>快速入门&nbsp;</a></li><li data-nav-id=https://xtls.github.io/config/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/config/>配置文件&nbsp;📜</a><ul><li data-nav-id=https://xtls.github.io/config/base/ class="dd-item haschildren
item_level_$level"><a href=/config/base/>基础配置模块&nbsp;</a>
<i class="fas fa-chevron-right ddexp"></i><ul><li data-nav-id=https://xtls.github.io/config/base/log/ class="dd-item
item_level_$level"><a href=/config/base/log/>日志配置</a></li><li data-nav-id=https://xtls.github.io/config/base/api/ class="dd-item
item_level_$level"><a href=/config/base/api/>API接口</a></li><li data-nav-id=https://xtls.github.io/config/base/dns/ class="dd-item
item_level_$level"><a href=/config/base/dns/>内置DNS服务器</a></li><li data-nav-id=https://xtls.github.io/config/base/routing/ class="dd-item
item_level_$level"><a href=/config/base/routing/>路由</a></li><li data-nav-id=https://xtls.github.io/config/base/policy/ class="dd-item
item_level_$level"><a href=/config/base/policy/>本地策略</a></li><li data-nav-id=https://xtls.github.io/config/base/inbounds/ class="dd-item
item_level_$level"><a href=/config/base/inbounds/>Inbounds</a></li><li data-nav-id=https://xtls.github.io/config/base/outbounds/ class="dd-item
item_level_$level"><a href=/config/base/outbounds/>Outbounds</a></li><li data-nav-id=https://xtls.github.io/config/base/transport/ class="dd-item
item_level_$level"><a href=/config/base/transport/>传输方式</a></li><li data-nav-id=https://xtls.github.io/config/base/stats/ class="dd-item
item_level_$level"><a href=/config/base/stats/>统计信息</a></li><li data-nav-id=https://xtls.github.io/config/base/reverse/ class="dd-item
item_level_$level"><a href=/config/base/reverse/>反向代理</a></li></ul></li><li data-nav-id=https://xtls.github.io/config/inbound-protocols/ class="dd-item
item_level_$level"><a href=/config/inbound-protocols/>Inbounds 可用协议列表</a></li><li data-nav-id=https://xtls.github.io/config/outbound-protocols/ class="dd-item
item_level_$level"><a href=/config/outbound-protocols/>Outbounds 可用协议列表</a></li><li data-nav-id=https://xtls.github.io/config/transports/ class="dd-item
item_level_$level"><a href=/config/transports/>传输方式列表</a></li><li data-nav-id=https://xtls.github.io/config/vless/ class="dd-item
item_level_$level"><a href=/config/vless/>VLESS 协议详解</a></li><li data-nav-id=https://xtls.github.io/config/fallback/ class="dd-item
item_level_$level"><a href=/config/fallback/>Fallbacks</a></li><li data-nav-id=https://xtls.github.io/config/xtls/ class="dd-item
item_level_$level"><a href=/config/xtls/>XTLS 深度剖析</a></li><li data-nav-id=https://xtls.github.io/config/env/ class="dd-item
item_level_$level"><a href=/config/env/>环境变量</a></li><li data-nav-id=https://xtls.github.io/config/multiple_config/ class="dd-item alwaysopen
item_level_$level"><a href=/config/multiple_config/>多文件配置</a></li></ul></li><li data-nav-id=https://xtls.github.io/documents/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/documents/>使用心得&nbsp;📚</a><ul><li data-nav-id=https://xtls.github.io/documents/level-0/ class="dd-item alwaysopen
item_level_$level"><a href=/documents/level-0/>小小白白话文&nbsp;📙</a></li><li data-nav-id=https://xtls.github.io/documents/level-1/ class="dd-item alwaysopen
item_level_$level"><a href=/documents/level-1/>入门技巧&nbsp;📚</a></li><li data-nav-id=https://xtls.github.io/documents/level-2/ class="dd-item alwaysopen
item_level_$level"><a href=/documents/level-2/>进阶文档&nbsp;📘</a></li></ul></li><li data-nav-id=https://xtls.github.io/develop/ class="dd-item parent haschildren
item_level_$level"><i class="fas fa-chevron-down ddexp"></i><a href=/develop/>开发指南&nbsp;🖥️</a><ul><li data-nav-id=https://xtls.github.io/develop/intro/ class="dd-item parent active alwaysopen
item_level_$level"><a href=/develop/intro/>开发手册</a></li><li data-nav-id=https://xtls.github.io/develop/protocols/ class="dd-item alwaysopen
item_level_$level"><a href=/develop/protocols/>协议详解</a></li></ul></li><li data-nav-id=https://xtls.github.io/faq/ class="dd-item alwaysopen
item_level_$level"><a href=/faq/>常见问答&nbsp;💬</a></li><li data-nav-id=https://xtls.github.io/caseslip/ class="dd-item alwaysopen
item_level_$level"><a href=/caseslip/>大案牍术&nbsp;</a></li><hr><li data-nav-id=https://xtls.github.io/links/ class="dd-item alwaysopen
item_level_$level"><a href=/links/>常用链接&nbsp;🤝</a></li></ul></aside><section class=page><nav id=ariane aria-label=breadcrumb><ol class=ariane><li><a class=text-link href=https://xtls.github.io></a></li><li><a class=text-link href=/develop/>开发指南</a></li><li><a class=text-link href=/develop/intro/>开发手册</a></li><li class=active>开发规范</li></ol></nav><h1>开发手册<span>开发规范</span></h1><nav class=subpages><li><a title=$pagetitle href=/develop/intro/compile/>编译</a></li><li><a title=$pagetitle href=/develop/intro/design/>设计思路</a></li><li class=active><a title=$pagetitle href=/develop/intro/guide/>开发规范</a></li></nav><div class=jump-to-section><span onclick="$h=$(this),$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right'})})"><span class="fas fa-align-right"></span><i class="fas fa-chevron-right"></i></span><nav id=TableOfContents><ul><li><a href=#基本>基本</a><ul><li><a href=#版本控制>版本控制</a></li><li><a href=#分支branch>分支（Branch）</a></li><li><a href=#发布release>发布（Release）</a></li><li><a href=#引用其它项目>引用其它项目</a></li></ul></li><li><a href=#开发流程>开发流程</a><ul><li><a href=#写代码之前>写代码之前</a></li><li><a href=#修改代码>修改代码</a></li><li><a href=#pull-request>Pull Request</a></li><li><a href=#对代码的修改>对代码的修改</a></li></ul></li><li><a href=#xray-编码规范>Xray 编码规范</a><ul><li><a href=#代码结构>代码结构</a></li><li><a href=#编码规范>编码规范</a></li></ul></li></ul></nav></div><div class=content><h2 ref=基本>基本</h2><a class=anchor id=基本></a><hr><h3 ref=版本控制>版本控制</h3><a class=anchor id=版本控制></a><hr><p>project X 的代码被托管在github上:</p><ul><li>xray 核心 <a href=https://github.com/XTLS/Xray-core>xray-core</a></li><li>xray-flutter <a href=https://github.com/XTLS/Xray-flutter>xray-flutter</a></li><li>安装脚本 <a href=https://github.com/XTLS/Xray-install>Xray-install</a></li><li>数据文件 <a href=https://github.com/XTLS/Xray-rules-dat>Xray-rules-dat</a></li><li>配置模板 <a href=https://github.com/XTLS/Xray-examples>Xray-examples</a></li><li>xray文档 <a href=https://github.com/XTLS/XTLS.github.io>XTLS.github.io</a></li></ul><p>您可以使用 <a href=https://git-scm.com/>Git</a> 来获取代码.</p><br><h3 ref=分支branch>分支（Branch）</h3><a class=anchor id=分支branch></a><hr><p>本项目的主干分支为 main, main 分支也是发布时所使用的代码分支, 因此需要确保 master 在任一时刻都是可编译可使用的。</p><p>如果需要开发新的功能</p><ul><li>请新开分支进行开发, 在开发完成并且经过充分测试后, 合并回主干分支.</li><li>新开分支如没有必要再存在时, 可以去除.</li></ul><br><h3 ref=发布release>发布（Release）</h3><a class=anchor id=发布release></a><hr><p><span class="badge badge-warning">In progress</span></p><ul><li>建立尝鲜版本和稳定版本两个发布通道<ul><li>临时版本, 主要用于特定情况的测试(比如从分支build的), 于TG群内/issue回复等渠道 发布特定版本</li><li>尝鲜版本可以为daily build , 用于尝鲜和获得即时反馈和再改进.</li><li>稳定版本为定时更新(比如周更), 合并稳定的修改并发布.</li></ul></li></ul><br><h3 ref=引用其它项目>引用其它项目</h3><a class=anchor id=引用其它项目></a><hr><ul><li>Golang<ul><li>产品代码建议使用 Golang 标准库和 <a href="https://pkg.go.dev/search?q=golang.org%2Fx">golang.org/x/</a> 下的库；</li><li>如需引用其它项目，请事先创建 issue 讨论；</li></ul></li><li>其它<ul><li>不违反双方的协议，且对项目有帮助的工具，都可以使用。</li></ul></li></ul><br><h2 ref=开发流程>开发流程</h2><a class=anchor id=开发流程></a><hr><h3 ref=写代码之前>写代码之前</h3><a class=anchor id=写代码之前></a><hr><p>发现任何问题，或对项目有任何想法，请创建 Issue 讨论以减少重复劳动和消耗在代码上的时间。</p><br><h3 ref=修改代码>修改代码</h3><a class=anchor id=修改代码></a><hr><ul><li>Golang<ul><li>请参考 <a href=https://golang.org/doc/effective_go.html>Effective Go</a>；</li><li>每一次 push 之前，请运行：<code>go fmt ./...</code> 和 <code>go fmt -s -l -e -w $(find . -type f -name "*.go" ! -name "*.pb.go")</code>；</li><li>每一次 push 之前，请确保测试通过：<code>go test ./...</code>；</li><li>提交 pull request 之前，请确保新增代码有超过 70% 的代码覆盖率（code coverage）；</li></ul></li><li>其它<ul><li>请注意代码的可读性。</li></ul></li></ul><br><h3 ref=pull-request>Pull Request</h3><a class=anchor id=pull-request></a><hr><ul><li>提交 PR 之前，请先运行 <code>git pull https://github.com/xray/xray-core.git</code> 以确保 merge 可顺利进行；</li><li>一个 PR 只做一件事，如有对多个 bug 的修复，请对每一个 bug 提交一个 PR；</li><li>由于 Golang 的特殊需求（Package path），Go 项目的 PR 流程和其它项目有所不同 ,建议流程如下：<ol><li>先 Fork 本项目，创建自己的 <code>github.com/your/Xray-core</code> 仓库；</li><li>克隆自己的 Xray 仓库到本地：<code>git clone https://github.com/your/Xray-core.git</code>；</li><li>基于 <code>main</code> 分支创建新的分支；</li><li>在自行创建的分支上作修改并提交修改(commit)；</li><li>在推送(push)修改完成的分支到自己的仓库前，先切换到 <code>main</code> 分支，运行 <code>git pull https://github.com/v2fly/Xray-core.git</code> 拉取最新的远端代码；</li><li>如果上一步拉取得到了新的远端代码，则切换到之前自己创建的分支，运行 <code>git rebase master</code> 执行分支合并操作。如遇到文件冲突，则需要解决冲突；</li><li>上一步处理完毕后，就可以把自己创建的分支推送到自己的仓库：<code>git push -u origin your-branch</code></li><li>最后，把自己仓库的新推送的分支往 <code>xtls/Xray-core</code> 的 <code>main</code> 分支发 PR 即可；</li><li>请在 PR 的标题和正文中，完整表述此次 PR 解决的问题 / 新增的功能 / 代码所做的修改的用意等；</li><li>耐心等待开发者的回应。</li></ol></li></ul><h3 ref=对代码的修改>对代码的修改</h3><a class=anchor id=对代码的修改></a><hr><h4 ref=功能性问题>功能性问题</h4><a class=anchor id=功能性问题></a><hr><p>请提交至少一个测试用例（Test Case）来验证对现有功能的改动。</p><h4 ref=性能相关>性能相关</h4><a class=anchor id=性能相关></a><hr><p>请提交必要的测试数据来证明现有代码的性能缺陷，或是新增代码的性能提升。</p><h4 ref=新功能>新功能</h4><a class=anchor id=新功能></a><hr><ul><li>如果新增功能对已有功能不影响，请提供可以开启/关闭的开关（如 flag），并使新功能保持默认关闭的状态；</li><li>大型新功能（比如增加一个新的协议）开发之前，请先提交一个 issue，讨论完毕之后再进行开发。</li></ul><h4 ref=其它>其它</h4><a class=anchor id=其它></a><hr><p>视具体情况而定。</p><br><h2 ref=xray-编码规范>Xray 编码规范</h2><a class=anchor id=xray-编码规范></a><hr><p>以下内容适用于 Xray 中的 Golang 代码。</p><h3 ref=代码结构>代码结构</h3><a class=anchor id=代码结构></a><hr><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>Xray-core
├── app        // 应用模块
│   ├── router // 路由
├── common     // 公用代码
├── proxy      // 通讯协议
│   ├── blackhole
│   ├── dokodemo-door
│   ├── freedom
│   ├── socks
│   ├── vmess
├── transport  // 传输模块
</code></pre></div><h3 ref=编码规范>编码规范</h3><a class=anchor id=编码规范></a><hr><p>基本与 Golang 官方所推荐做法一致，有一些例外。写在这里以方便大家熟悉 Golang。</p><h4 ref=命名>命名</h4><a class=anchor id=命名></a><hr><ul><li>文件和目录名尽量使用单个英文单词，比如 hello.go；<ul><li>如果实在没办法，则目录使用连接线／文件名使用下划线连接两个（或多个单词），比如 hello-world/hello_again.go；</li><li>测试代码使用 _test.go 结尾；</li></ul></li><li>类型使用 Pascal 命名法，比如 ConnectionHandler；<ul><li>对缩写不强制小写，即 HTML 不必写成 Html；</li></ul></li><li>公开成员变量也使用 Pascal 命名法；</li><li>私有成员变量使用 <a href=https://zh.wikipedia.org/wiki/%E9%A7%9D%E5%B3%B0%E5%BC%8F%E5%A4%A7%E5%B0%8F%E5%AF%AB>小驼峰式命名法</a> ，如 <code>privateAttribute</code> ；</li><li>为了方便重构，方法建议全部使用 Pascal 命名法；<ul><li>完全私有的类型放入 <code>internal</code> 。</li></ul></li></ul><br><h4 ref=内容组织>内容组织</h4><a class=anchor id=内容组织></a><hr><ul><li>一个文件包含一个主要类型，及其相关的私有函数等；</li><li>测试相关的文件，如 Mock 等工具类，放入 testing 子目录。</li></ul></div><div class=chevrons></div></section><section class=right-menu><div class=TableOfContents><label><i class="fas fa-align-right"></i>&nbsp;&nbsp;</label><nav><ul><li><a href=/develop/intro/guide/>开发规范</a></li></ul></nav><nav id=TableOfContents><ul><li><a href=#基本>基本</a><ul><li><a href=#版本控制>版本控制</a></li><li><a href=#分支branch>分支（Branch）</a></li><li><a href=#发布release>发布（Release）</a></li><li><a href=#引用其它项目>引用其它项目</a></li></ul></li><li><a href=#开发流程>开发流程</a><ul><li><a href=#写代码之前>写代码之前</a></li><li><a href=#修改代码>修改代码</a></li><li><a href=#pull-request>Pull Request</a></li><li><a href=#对代码的修改>对代码的修改</a></li></ul></li><li><a href=#xray-编码规范>Xray 编码规范</a><ul><li><a href=#代码结构>代码结构</a></li><li><a href=#编码规范>编码规范</a></li></ul></li></ul></nav></div><div class=Actions><nav><ul><li><a href=https://github.com/XTLS/XTLS.github.io/tree/main/content/develop/intro/guide.md target=blank><i class="fab fa-github"></i></a></li><li><i class="fas fa-calendar"></i>23 December 2020</li></ul></nav></div></section></article><footer><footer><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/stack><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/XTLS><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020-2021 ProjectX Community All Rights Reserved</small></div></div></div></footer></footer></body></html>