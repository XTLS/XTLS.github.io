<!DOCTYPE html>
<html lang="ru-RU">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.2">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/logo.png"><title>【Глава 7】Настройка Xray на сервере | Project X</title><meta name="description" content="Официальная документация Xray">
    <link rel="preload" href="/assets/style-DPNvLHrM.css" as="style"><link rel="stylesheet" href="/assets/style-DPNvLHrM.css">
    <link rel="modulepreload" href="/assets/app-D0lKU3Y-.js"><link rel="modulepreload" href="/assets/ch07-xray-server.html-BMC39V_R.js"><link rel="modulepreload" href="/assets/ch07-xray-server.html-BWXn8hf_.js">
    <link rel="prefetch" href="/assets/index.html-D9G6CNbk.js" as="script"><link rel="prefetch" href="/assets/news.html-C-ufwDLv.js" as="script"><link rel="prefetch" href="/assets/index.html-CTbMiGG2.js" as="script"><link rel="prefetch" href="/assets/index.html-B2ETL5pY.js" as="script"><link rel="prefetch" href="/assets/api.html-5y-QWEO9.js" as="script"><link rel="prefetch" href="/assets/dns.html-BfPt-22g.js" as="script"><link rel="prefetch" href="/assets/fakedns.html-BSHcVJMt.js" as="script"><link rel="prefetch" href="/assets/inbound.html-CsvOghW7.js" as="script"><link rel="prefetch" href="/assets/log.html-De0YGftm.js" as="script"><link rel="prefetch" href="/assets/metrics.html-C1kvghj5.js" as="script"><link rel="prefetch" href="/assets/observatory.html-Dkgoiajw.js" as="script"><link rel="prefetch" href="/assets/outbound.html-C10j64xi.js" as="script"><link rel="prefetch" href="/assets/policy.html-CErsqhDk.js" as="script"><link rel="prefetch" href="/assets/reverse.html-BzUnx5j0.js" as="script"><link rel="prefetch" href="/assets/routing.html-Bx5bopot.js" as="script"><link rel="prefetch" href="/assets/stats.html-DHCl8ess.js" as="script"><link rel="prefetch" href="/assets/transport.html-BXdIU77e.js" as="script"><link rel="prefetch" href="/assets/index.html-CA-WluU-.js" as="script"><link rel="prefetch" href="/assets/command.html-opo_NLX2.js" as="script"><link rel="prefetch" href="/assets/config.html-O0hv2z0b.js" as="script"><link rel="prefetch" href="/assets/document.html-vroedGik.js" as="script"><link rel="prefetch" href="/assets/install.html-C6eLysya.js" as="script"><link rel="prefetch" href="/assets/index.html-QftOk6LQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CshDtg4G.js" as="script"><link rel="prefetch" href="/assets/compile.html-C08Er0mK.js" as="script"><link rel="prefetch" href="/assets/design.html-JvR3o2wW.js" as="script"><link rel="prefetch" href="/assets/guide.html-CIw6ZqK-.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-BECLirWp.js" as="script"><link rel="prefetch" href="/assets/muxcool.html-DxsTQuoq.js" as="script"><link rel="prefetch" href="/assets/vless.html-bx0zLtjU.js" as="script"><link rel="prefetch" href="/assets/vmess.html-DH5KSkx4.js" as="script"><link rel="prefetch" href="/assets/browser_dialer.html-DYjgEhDN.js" as="script"><link rel="prefetch" href="/assets/env.html-x3PGFNW0.js" as="script"><link rel="prefetch" href="/assets/fallback.html-BCz8baOr.js" as="script"><link rel="prefetch" href="/assets/multiple.html-CA4IQdBs.js" as="script"><link rel="prefetch" href="/assets/xtls.html-DTQkH1EU.js" as="script"><link rel="prefetch" href="/assets/dokodemo.html-BVzbqjRe.js" as="script"><link rel="prefetch" href="/assets/http.html-BIzz1n6q.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-Bog2IQ_X.js" as="script"><link rel="prefetch" href="/assets/socks.html-B_KFCfGa.js" as="script"><link rel="prefetch" href="/assets/trojan.html-BkQCt-32.js" as="script"><link rel="prefetch" href="/assets/vless.html-CxK3eXqB.js" as="script"><link rel="prefetch" href="/assets/vmess.html-BSAH9EwQ.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-DI0HSIg5.js" as="script"><link rel="prefetch" href="/assets/blackhole.html-C3j-gtFm.js" as="script"><link rel="prefetch" href="/assets/dns.html-R1M3D1VY.js" as="script"><link rel="prefetch" href="/assets/freedom.html-B9-DgY3P.js" as="script"><link rel="prefetch" href="/assets/http.html-CqFywJ_o.js" as="script"><link rel="prefetch" href="/assets/loopback.html-CYltRkS6.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-BdSAub8s.js" as="script"><link rel="prefetch" href="/assets/socks.html-C_Ryg_Zn.js" as="script"><link rel="prefetch" href="/assets/trojan.html-_aC10_zp.js" as="script"><link rel="prefetch" href="/assets/vless.html-sPPpqcW_.js" as="script"><link rel="prefetch" href="/assets/vmess.html-3bHG9IEs.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-DMp0Htsq.js" as="script"><link rel="prefetch" href="/assets/grpc.html-BOwRBc6V.js" as="script"><link rel="prefetch" href="/assets/h2.html-B-_cdxSw.js" as="script"><link rel="prefetch" href="/assets/httpupgrade.html-DNm5DiZb.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-CmaMJX_Q.js" as="script"><link rel="prefetch" href="/assets/splithttp.html-CT8Yo7fX.js" as="script"><link rel="prefetch" href="/assets/tcp.html-tAb-Rdu-.js" as="script"><link rel="prefetch" href="/assets/websocket.html-J4zD0ZXr.js" as="script"><link rel="prefetch" href="/assets/index.html-CpLT_ZsY.js" as="script"><link rel="prefetch" href="/assets/ch01-preface.html-DmNJxKif.js" as="script"><link rel="prefetch" href="/assets/ch02-preparation.html-BTKGqj9u.js" as="script"><link rel="prefetch" href="/assets/ch03-ssh.html-Bs4sxOG7.js" as="script"><link rel="prefetch" href="/assets/ch04-security.html-BgZQf6Zy.js" as="script"><link rel="prefetch" href="/assets/ch05-webpage.html-C3ISjTL0.js" as="script"><link rel="prefetch" href="/assets/ch06-certificates.html-g-a588dM.js" as="script"><link rel="prefetch" href="/assets/ch07-xray-server.html-CL7ODUGu.js" as="script"><link rel="prefetch" href="/assets/ch08-xray-clients.html-D0DH-0jR.js" as="script"><link rel="prefetch" href="/assets/ch09-appendix.html-B-sOxmCt.js" as="script"><link rel="prefetch" href="/assets/index.html-Z8xBvZ8J.js" as="script"><link rel="prefetch" href="/assets/fallbacks-lv1.html-Dyr_PhvB.js" as="script"><link rel="prefetch" href="/assets/fallbacks-with-sni.html-V5VzGt_a.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part1.html-C-IzJ3qA.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part2.html-Shikx9Ih.js" as="script"><link rel="prefetch" href="/assets/work.html-CEe4qs2X.js" as="script"><link rel="prefetch" href="/assets/index.html-DC6-KGmE.js" as="script"><link rel="prefetch" href="/assets/iptables_gid.html-BMSyFQlC.js" as="script"><link rel="prefetch" href="/assets/nginx_or_haproxy_tls_tunnel.html-pJln5JiT.js" as="script"><link rel="prefetch" href="/assets/redirect.html-qKHxqUqo.js" as="script"><link rel="prefetch" href="/assets/tproxy.html-ByDe25dh.js" as="script"><link rel="prefetch" href="/assets/tproxy_ipv4_and_ipv6.html-D-5zdr32.js" as="script"><link rel="prefetch" href="/assets/traffic_stats.html-0T5V4GoX.js" as="script"><link rel="prefetch" href="/assets/warp.html-BDXJx2co.js" as="script"><link rel="prefetch" href="/assets/news.html-Cct6yV3F.js" as="script"><link rel="prefetch" href="/assets/index.html-CVcFP_qj.js" as="script"><link rel="prefetch" href="/assets/api.html-Kao4_KiT.js" as="script"><link rel="prefetch" href="/assets/dns.html-CvTCwYNS.js" as="script"><link rel="prefetch" href="/assets/fakedns.html-Dvu3AZyj.js" as="script"><link rel="prefetch" href="/assets/inbound.html-D-xnQ-Qr.js" as="script"><link rel="prefetch" href="/assets/log.html-IZnUGgyl.js" as="script"><link rel="prefetch" href="/assets/metrics.html-BLJ8GVn6.js" as="script"><link rel="prefetch" href="/assets/observatory.html-CcNQ0eYH.js" as="script"><link rel="prefetch" href="/assets/outbound.html-CzOKWWkv.js" as="script"><link rel="prefetch" href="/assets/policy.html-C8ASaUzS.js" as="script"><link rel="prefetch" href="/assets/reverse.html-BnnvxzqT.js" as="script"><link rel="prefetch" href="/assets/routing.html-zaMrIcUV.js" as="script"><link rel="prefetch" href="/assets/stats.html-DGZuatV1.js" as="script"><link rel="prefetch" href="/assets/transport.html-C8xqLmyi.js" as="script"><link rel="prefetch" href="/assets/index.html-CFqc6OBy.js" as="script"><link rel="prefetch" href="/assets/index.html-DFwA2xNy.js" as="script"><link rel="prefetch" href="/assets/command.html-CnAfnl0M.js" as="script"><link rel="prefetch" href="/assets/config.html-DrlSKA0W.js" as="script"><link rel="prefetch" href="/assets/document.html-CBY4dmVD.js" as="script"><link rel="prefetch" href="/assets/install.html-BGflkXM3.js" as="script"><link rel="prefetch" href="/assets/news.html-CHwot1ez.js" as="script"><link rel="prefetch" href="/assets/index.html-Br3dj_2c.js" as="script"><link rel="prefetch" href="/assets/api.html-DLDnYtg0.js" as="script"><link rel="prefetch" href="/assets/dns.html-DfoiH0ad.js" as="script"><link rel="prefetch" href="/assets/fakedns.html-DFAPe69C.js" as="script"><link rel="prefetch" href="/assets/inbound.html-D56yUQvN.js" as="script"><link rel="prefetch" href="/assets/log.html-DcQn41R9.js" as="script"><link rel="prefetch" href="/assets/metrics.html-wNzErJVc.js" as="script"><link rel="prefetch" href="/assets/observatory.html-CQ1B9WMF.js" as="script"><link rel="prefetch" href="/assets/outbound.html-BaSyw3Ug.js" as="script"><link rel="prefetch" href="/assets/policy.html-CZXmUkYI.js" as="script"><link rel="prefetch" href="/assets/reverse.html-B5DaFRsx.js" as="script"><link rel="prefetch" href="/assets/routing.html-DzeMyjIq.js" as="script"><link rel="prefetch" href="/assets/stats.html-CkQuuoBx.js" as="script"><link rel="prefetch" href="/assets/transport.html-vxVfDJHg.js" as="script"><link rel="prefetch" href="/assets/index.html-BBMcLiPC.js" as="script"><link rel="prefetch" href="/assets/index.html-B-J-mqnv.js" as="script"><link rel="prefetch" href="/assets/command.html-DLT-4XC7.js" as="script"><link rel="prefetch" href="/assets/config.html-CpMF1H3m.js" as="script"><link rel="prefetch" href="/assets/document.html-Cv2iGxpB.js" as="script"><link rel="prefetch" href="/assets/install.html-Cmyvi2cp.js" as="script"><link rel="prefetch" href="/assets/transparent_proxy.html-DZNi96TQ.js" as="script"><link rel="prefetch" href="/assets/browser_dialer.html-Bdbrov2m.js" as="script"><link rel="prefetch" href="/assets/env.html-kVBaIisu.js" as="script"><link rel="prefetch" href="/assets/fallback.html-Cz26Rtbk.js" as="script"><link rel="prefetch" href="/assets/multiple.html-672DYUik.js" as="script"><link rel="prefetch" href="/assets/xtls.html-enE-oLop.js" as="script"><link rel="prefetch" href="/assets/dokodemo.html-tumWX5uf.js" as="script"><link rel="prefetch" href="/assets/http.html-Dk_GJXk3.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-nKE9-JwE.js" as="script"><link rel="prefetch" href="/assets/socks.html-BYoEVGSJ.js" as="script"><link rel="prefetch" href="/assets/trojan.html-2VAwem9J.js" as="script"><link rel="prefetch" href="/assets/vless.html-BCCfQS7T.js" as="script"><link rel="prefetch" href="/assets/vmess.html-DmF6uMmY.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-BIApe7Jj.js" as="script"><link rel="prefetch" href="/assets/blackhole.html-Cv99Ln_e.js" as="script"><link rel="prefetch" href="/assets/dns.html-B4Qc1gmf.js" as="script"><link rel="prefetch" href="/assets/freedom.html-CyBl95Ch.js" as="script"><link rel="prefetch" href="/assets/http.html-BW71su7G.js" as="script"><link rel="prefetch" href="/assets/loopback.html-DBZDnpde.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-Cfe33M9q.js" as="script"><link rel="prefetch" href="/assets/socks.html-ZsLxpdI_.js" as="script"><link rel="prefetch" href="/assets/trojan.html-C_OdgAQH.js" as="script"><link rel="prefetch" href="/assets/vless.html-DNT9jIbN.js" as="script"><link rel="prefetch" href="/assets/vmess.html-BnKkO-oz.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-B1zHQq-E.js" as="script"><link rel="prefetch" href="/assets/grpc.html-D7nAIvyK.js" as="script"><link rel="prefetch" href="/assets/h2.html-9I7eRGud.js" as="script"><link rel="prefetch" href="/assets/httpupgrade.html-DpYANPWG.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-D1BaSNsx.js" as="script"><link rel="prefetch" href="/assets/splithttp.html-YgSRxFF4.js" as="script"><link rel="prefetch" href="/assets/tcp.html-Dvv-qFsr.js" as="script"><link rel="prefetch" href="/assets/websocket.html-CDgG-JKn.js" as="script"><link rel="prefetch" href="/assets/compile.html-CSlVqiWd.js" as="script"><link rel="prefetch" href="/assets/design.html-CnO0gj1h.js" as="script"><link rel="prefetch" href="/assets/guide.html-C1S7IA49.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-VU4-Z4x2.js" as="script"><link rel="prefetch" href="/assets/muxcool.html-CEJDgOyw.js" as="script"><link rel="prefetch" href="/assets/vless.html-DH9DXlDy.js" as="script"><link rel="prefetch" href="/assets/vmess.html-DRYwVgEC.js" as="script"><link rel="prefetch" href="/assets/index.html-B7FLw-wS.js" as="script"><link rel="prefetch" href="/assets/ch01-preface.html-CpS2RBBO.js" as="script"><link rel="prefetch" href="/assets/ch02-preparation.html-nD3-r55P.js" as="script"><link rel="prefetch" href="/assets/ch03-ssh.html-6Lvt6PUL.js" as="script"><link rel="prefetch" href="/assets/ch04-security.html-B6qoKme-.js" as="script"><link rel="prefetch" href="/assets/ch05-webpage.html-DzsY94d_.js" as="script"><link rel="prefetch" href="/assets/ch06-certificates.html-Ddg6ioji.js" as="script"><link rel="prefetch" href="/assets/ch07-xray-server.html-C13N5hD6.js" as="script"><link rel="prefetch" href="/assets/ch08-xray-clients.html-DQ22p1_O.js" as="script"><link rel="prefetch" href="/assets/ch09-appendix.html-CgxfJw0n.js" as="script"><link rel="prefetch" href="/assets/index.html-NEtYQEGC.js" as="script"><link rel="prefetch" href="/assets/fallbacks-lv1.html-DzqMpBvO.js" as="script"><link rel="prefetch" href="/assets/fallbacks-with-sni.html--6P9o5e1.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part1.html-CLrmD7am.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part2.html-BeZDTPEs.js" as="script"><link rel="prefetch" href="/assets/work.html-bZWwnav2.js" as="script"><link rel="prefetch" href="/assets/index.html-CL_S8-vB.js" as="script"><link rel="prefetch" href="/assets/iptables_gid.html-C-yflUZU.js" as="script"><link rel="prefetch" href="/assets/nginx_or_haproxy_tls_tunnel.html-Gb-c4jql.js" as="script"><link rel="prefetch" href="/assets/redirect.html-CkD_E0gF.js" as="script"><link rel="prefetch" href="/assets/tproxy.html-BW6K5LzA.js" as="script"><link rel="prefetch" href="/assets/tproxy_ipv4_and_ipv6.html-BQJ6GusY.js" as="script"><link rel="prefetch" href="/assets/traffic_stats.html-DD1S40Up.js" as="script"><link rel="prefetch" href="/assets/warp.html-C4DFBgRI.js" as="script"><link rel="prefetch" href="/assets/browser_dialer.html-DHvZocHd.js" as="script"><link rel="prefetch" href="/assets/env.html-BcRLB4iC.js" as="script"><link rel="prefetch" href="/assets/fallback.html-BtkFw_Xq.js" as="script"><link rel="prefetch" href="/assets/multiple.html-L9QltWwj.js" as="script"><link rel="prefetch" href="/assets/xtls.html-ByQJIYGC.js" as="script"><link rel="prefetch" href="/assets/dokodemo.html-B3AutCKN.js" as="script"><link rel="prefetch" href="/assets/http.html-wmoV0Z5H.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-Dq6vO-NY.js" as="script"><link rel="prefetch" href="/assets/socks.html-HP5cpkrw.js" as="script"><link rel="prefetch" href="/assets/trojan.html-ur2ZEK_x.js" as="script"><link rel="prefetch" href="/assets/vless.html-Dp7gCWtk.js" as="script"><link rel="prefetch" href="/assets/vmess.html-BtGpHvfz.js" as="script"><link rel="prefetch" href="/assets/blackhole.html-DWoVmjiZ.js" as="script"><link rel="prefetch" href="/assets/dns.html-QSFk3MG9.js" as="script"><link rel="prefetch" href="/assets/freedom.html-CnbeHbkV.js" as="script"><link rel="prefetch" href="/assets/http.html-o0wpiHQf.js" as="script"><link rel="prefetch" href="/assets/loopback.html-BcZmhFf5.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-S-jhNF8h.js" as="script"><link rel="prefetch" href="/assets/socks.html-zyIZHHJ4.js" as="script"><link rel="prefetch" href="/assets/trojan.html-2ngT_7cs.js" as="script"><link rel="prefetch" href="/assets/vless.html-CNa_dakW.js" as="script"><link rel="prefetch" href="/assets/vmess.html-D5q0vDPy.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-DILhdRFk.js" as="script"><link rel="prefetch" href="/assets/grpc.html-1JoA2je9.js" as="script"><link rel="prefetch" href="/assets/h2.html-BOxtTm8R.js" as="script"><link rel="prefetch" href="/assets/httpupgrade.html-C5iPswVE.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-DILru_l-.js" as="script"><link rel="prefetch" href="/assets/splithttp.html-BsCvuL-p.js" as="script"><link rel="prefetch" href="/assets/tcp.html-BgZgnk7j.js" as="script"><link rel="prefetch" href="/assets/websocket.html-DNoxTZYE.js" as="script"><link rel="prefetch" href="/assets/compile.html-D59MH5rf.js" as="script"><link rel="prefetch" href="/assets/design.html-Ddh8g14z.js" as="script"><link rel="prefetch" href="/assets/guide.html-BdEYZrHF.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-DAmKBEn3.js" as="script"><link rel="prefetch" href="/assets/muxcool.html-mhoEooTk.js" as="script"><link rel="prefetch" href="/assets/vless.html-CkQDajpI.js" as="script"><link rel="prefetch" href="/assets/vmess.html-DtwTJf0_.js" as="script"><link rel="prefetch" href="/assets/index.html-CpXf73_p.js" as="script"><link rel="prefetch" href="/assets/ch01-preface.html-w7EJag-g.js" as="script"><link rel="prefetch" href="/assets/ch02-preparation.html-Dgjcbj9R.js" as="script"><link rel="prefetch" href="/assets/ch03-ssh.html-SW0FgDU9.js" as="script"><link rel="prefetch" href="/assets/ch04-security.html-DMyIYFbc.js" as="script"><link rel="prefetch" href="/assets/ch05-webpage.html-BJ9Dh4eq.js" as="script"><link rel="prefetch" href="/assets/ch06-certificates.html-CYpwWYQK.js" as="script"><link rel="prefetch" href="/assets/ch08-xray-clients.html-SOUUSYfz.js" as="script"><link rel="prefetch" href="/assets/ch09-appendix.html-CaY0Q2De.js" as="script"><link rel="prefetch" href="/assets/index.html-DIt_Qwmg.js" as="script"><link rel="prefetch" href="/assets/fallbacks-lv1.html-Cj8_C__Y.js" as="script"><link rel="prefetch" href="/assets/fallbacks-with-sni.html-UrPS3PK0.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part1.html-CrCZge13.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part2.html-BNHKIWxf.js" as="script"><link rel="prefetch" href="/assets/work.html-nNVb3F6P.js" as="script"><link rel="prefetch" href="/assets/index.html-nyT_8_ff.js" as="script"><link rel="prefetch" href="/assets/iptables_gid.html-5z8dtoE5.js" as="script"><link rel="prefetch" href="/assets/nginx_or_haproxy_tls_tunnel.html-CZEav5bi.js" as="script"><link rel="prefetch" href="/assets/redirect.html-IdxcHO8c.js" as="script"><link rel="prefetch" href="/assets/tproxy.html-BHj4GcZZ.js" as="script"><link rel="prefetch" href="/assets/tproxy_ipv4_and_ipv6.html-D9HsaVXj.js" as="script"><link rel="prefetch" href="/assets/traffic_stats.html-D5bPdgjj.js" as="script"><link rel="prefetch" href="/assets/warp.html-Dj49TU1P.js" as="script"><link rel="prefetch" href="/assets/transparent_proxy.html-C4cGXidp.js" as="script"><link rel="prefetch" href="/assets/transparent_proxy.html-CdU0iNrm.js" as="script"><link rel="prefetch" href="/assets/404.html-CnfmQthm.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-CfAIELtr.js" as="script"><link rel="prefetch" href="/assets/index.html-JXm6WlnS.js" as="script"><link rel="prefetch" href="/assets/news.html-BT7c1Jmu.js" as="script"><link rel="prefetch" href="/assets/index.html-_nugRUT8.js" as="script"><link rel="prefetch" href="/assets/index.html-DaV5prS9.js" as="script"><link rel="prefetch" href="/assets/api.html-CWnE2imi.js" as="script"><link rel="prefetch" href="/assets/dns.html-CdX8cYFo.js" as="script"><link rel="prefetch" href="/assets/fakedns.html-Dcaa_e-s.js" as="script"><link rel="prefetch" href="/assets/inbound.html-DlSur-ZR.js" as="script"><link rel="prefetch" href="/assets/log.html-DJquYs-a.js" as="script"><link rel="prefetch" href="/assets/metrics.html-BoNchdjW.js" as="script"><link rel="prefetch" href="/assets/observatory.html-DaMAyXlj.js" as="script"><link rel="prefetch" href="/assets/outbound.html-CWz8SM76.js" as="script"><link rel="prefetch" href="/assets/policy.html-XtHKmjes.js" as="script"><link rel="prefetch" href="/assets/reverse.html-D7VWR7eH.js" as="script"><link rel="prefetch" href="/assets/routing.html-pW7HD7Mg.js" as="script"><link rel="prefetch" href="/assets/stats.html-X_zONAoH.js" as="script"><link rel="prefetch" href="/assets/transport.html-hzYe9QwP.js" as="script"><link rel="prefetch" href="/assets/index.html-CpAIZzPA.js" as="script"><link rel="prefetch" href="/assets/command.html-CfdtFeHz.js" as="script"><link rel="prefetch" href="/assets/config.html-3p2zsQnk.js" as="script"><link rel="prefetch" href="/assets/document.html-BP0aVg02.js" as="script"><link rel="prefetch" href="/assets/install.html-4uYVVtjH.js" as="script"><link rel="prefetch" href="/assets/index.html-BhqQIbaD.js" as="script"><link rel="prefetch" href="/assets/index.html-_ZcQwvJF.js" as="script"><link rel="prefetch" href="/assets/compile.html-B0jk28xW.js" as="script"><link rel="prefetch" href="/assets/design.html-CCy0S9Ik.js" as="script"><link rel="prefetch" href="/assets/guide.html-li98aNrg.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-CbOs5C5_.js" as="script"><link rel="prefetch" href="/assets/muxcool.html-iZ507kKg.js" as="script"><link rel="prefetch" href="/assets/vless.html-Cn89wSE0.js" as="script"><link rel="prefetch" href="/assets/vmess.html-jGSwHk_X.js" as="script"><link rel="prefetch" href="/assets/browser_dialer.html-D9jbqkpj.js" as="script"><link rel="prefetch" href="/assets/env.html-CAg9KUwi.js" as="script"><link rel="prefetch" href="/assets/fallback.html-6Ne7fhYf.js" as="script"><link rel="prefetch" href="/assets/multiple.html-Dz4j1R9b.js" as="script"><link rel="prefetch" href="/assets/xtls.html-BairamnD.js" as="script"><link rel="prefetch" href="/assets/dokodemo.html-Cttt-XCd.js" as="script"><link rel="prefetch" href="/assets/http.html-OuyaX_mQ.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-DDS9ZUlz.js" as="script"><link rel="prefetch" href="/assets/socks.html-w-EeyeaP.js" as="script"><link rel="prefetch" href="/assets/trojan.html-DM5YWk5g.js" as="script"><link rel="prefetch" href="/assets/vless.html-DRNMy6Jd.js" as="script"><link rel="prefetch" href="/assets/vmess.html-DiLlhmZ0.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-BBY-iHqc.js" as="script"><link rel="prefetch" href="/assets/blackhole.html-CEzS2Fo1.js" as="script"><link rel="prefetch" href="/assets/dns.html-I2DavJOH.js" as="script"><link rel="prefetch" href="/assets/freedom.html-B5ovnbke.js" as="script"><link rel="prefetch" href="/assets/http.html-BV6-KrNt.js" as="script"><link rel="prefetch" href="/assets/loopback.html-BX3TcFib.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-DjWpHj3e.js" as="script"><link rel="prefetch" href="/assets/socks.html-DrEkdWNR.js" as="script"><link rel="prefetch" href="/assets/trojan.html-BePJIJvP.js" as="script"><link rel="prefetch" href="/assets/vless.html-B7DUASPC.js" as="script"><link rel="prefetch" href="/assets/vmess.html-DrVgevA8.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-Dm33VG8D.js" as="script"><link rel="prefetch" href="/assets/grpc.html-BwE8mQZF.js" as="script"><link rel="prefetch" href="/assets/h2.html-BAThevVn.js" as="script"><link rel="prefetch" href="/assets/httpupgrade.html-ZtuWpR8s.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-C1Kq_NPB.js" as="script"><link rel="prefetch" href="/assets/splithttp.html-vLazQvgM.js" as="script"><link rel="prefetch" href="/assets/tcp.html-BqKls5Kj.js" as="script"><link rel="prefetch" href="/assets/websocket.html-CZ4579Kp.js" as="script"><link rel="prefetch" href="/assets/index.html-D7-6pKLj.js" as="script"><link rel="prefetch" href="/assets/ch01-preface.html-DNjPh6Rt.js" as="script"><link rel="prefetch" href="/assets/ch02-preparation.html-CZpD0qi0.js" as="script"><link rel="prefetch" href="/assets/ch03-ssh.html-OZHXigAO.js" as="script"><link rel="prefetch" href="/assets/ch04-security.html-sf78h_2x.js" as="script"><link rel="prefetch" href="/assets/ch05-webpage.html-m2ZzTe2t.js" as="script"><link rel="prefetch" href="/assets/ch06-certificates.html-CQgZx3qi.js" as="script"><link rel="prefetch" href="/assets/ch07-xray-server.html-D2r0jYcl.js" as="script"><link rel="prefetch" href="/assets/ch08-xray-clients.html-CiT1P4k_.js" as="script"><link rel="prefetch" href="/assets/ch09-appendix.html-Dq4WoGgH.js" as="script"><link rel="prefetch" href="/assets/index.html-TQZ2Iai0.js" as="script"><link rel="prefetch" href="/assets/fallbacks-lv1.html-qIGDd9sg.js" as="script"><link rel="prefetch" href="/assets/fallbacks-with-sni.html-CjP7hOJQ.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part1.html-CIZFVp2p.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part2.html-BS8vE40I.js" as="script"><link rel="prefetch" href="/assets/work.html-D1JpnyZD.js" as="script"><link rel="prefetch" href="/assets/index.html-CVeS1Dwk.js" as="script"><link rel="prefetch" href="/assets/iptables_gid.html-DjwdihvJ.js" as="script"><link rel="prefetch" href="/assets/nginx_or_haproxy_tls_tunnel.html-oQ94bAl5.js" as="script"><link rel="prefetch" href="/assets/redirect.html-CI6Mapgo.js" as="script"><link rel="prefetch" href="/assets/tproxy.html-Bw7e5pOH.js" as="script"><link rel="prefetch" href="/assets/tproxy_ipv4_and_ipv6.html-1CmHS7te.js" as="script"><link rel="prefetch" href="/assets/traffic_stats.html-DcKln7Ym.js" as="script"><link rel="prefetch" href="/assets/warp.html-CHS_WSZF.js" as="script"><link rel="prefetch" href="/assets/news.html-MzB5XUgu.js" as="script"><link rel="prefetch" href="/assets/index.html-C9jfNysq.js" as="script"><link rel="prefetch" href="/assets/api.html-DJeh-Yvy.js" as="script"><link rel="prefetch" href="/assets/dns.html-jWwObcKb.js" as="script"><link rel="prefetch" href="/assets/fakedns.html-CCzk09Yd.js" as="script"><link rel="prefetch" href="/assets/inbound.html-BSa1qY5_.js" as="script"><link rel="prefetch" href="/assets/log.html-w73SruF4.js" as="script"><link rel="prefetch" href="/assets/metrics.html-CRh1jNX3.js" as="script"><link rel="prefetch" href="/assets/observatory.html-C5u8C5gw.js" as="script"><link rel="prefetch" href="/assets/outbound.html-C_uEXEgI.js" as="script"><link rel="prefetch" href="/assets/policy.html-K95SsaPr.js" as="script"><link rel="prefetch" href="/assets/reverse.html-BzmvgYOc.js" as="script"><link rel="prefetch" href="/assets/routing.html-DKPx50QY.js" as="script"><link rel="prefetch" href="/assets/stats.html-DbsAbtO_.js" as="script"><link rel="prefetch" href="/assets/transport.html-D3zfdxPS.js" as="script"><link rel="prefetch" href="/assets/index.html-CAUXKfpu.js" as="script"><link rel="prefetch" href="/assets/index.html-CYPA1eXW.js" as="script"><link rel="prefetch" href="/assets/command.html-B3pkf3On.js" as="script"><link rel="prefetch" href="/assets/config.html-sh5pe4Rr.js" as="script"><link rel="prefetch" href="/assets/document.html-OWsAtDp1.js" as="script"><link rel="prefetch" href="/assets/install.html-GtdCo7ex.js" as="script"><link rel="prefetch" href="/assets/news.html-BWYtRC9K.js" as="script"><link rel="prefetch" href="/assets/index.html-CkFDEuuo.js" as="script"><link rel="prefetch" href="/assets/api.html-CpC3ishB.js" as="script"><link rel="prefetch" href="/assets/dns.html-C-eYy5iE.js" as="script"><link rel="prefetch" href="/assets/fakedns.html-BBM2WxbU.js" as="script"><link rel="prefetch" href="/assets/inbound.html-vELvceHm.js" as="script"><link rel="prefetch" href="/assets/log.html-CUz3K6AY.js" as="script"><link rel="prefetch" href="/assets/metrics.html-BvxbdIdg.js" as="script"><link rel="prefetch" href="/assets/observatory.html-DHyLAvMc.js" as="script"><link rel="prefetch" href="/assets/outbound.html-ClG7kMXA.js" as="script"><link rel="prefetch" href="/assets/policy.html-CInEXfL6.js" as="script"><link rel="prefetch" href="/assets/reverse.html-DWq9dGRr.js" as="script"><link rel="prefetch" href="/assets/routing.html-yBFsGI13.js" as="script"><link rel="prefetch" href="/assets/stats.html-B_pryEyq.js" as="script"><link rel="prefetch" href="/assets/transport.html-DW1Pl95R.js" as="script"><link rel="prefetch" href="/assets/index.html-BPTxS8ei.js" as="script"><link rel="prefetch" href="/assets/index.html-C-cwOQO7.js" as="script"><link rel="prefetch" href="/assets/command.html-CaqVf_mF.js" as="script"><link rel="prefetch" href="/assets/config.html-B8O0bKp4.js" as="script"><link rel="prefetch" href="/assets/document.html-CDBgtI8A.js" as="script"><link rel="prefetch" href="/assets/install.html-CytRCcIt.js" as="script"><link rel="prefetch" href="/assets/transparent_proxy.html-CSYu6Ylz.js" as="script"><link rel="prefetch" href="/assets/browser_dialer.html-BtcwMnFD.js" as="script"><link rel="prefetch" href="/assets/env.html-Bazra703.js" as="script"><link rel="prefetch" href="/assets/fallback.html-Vku8M7JT.js" as="script"><link rel="prefetch" href="/assets/multiple.html-DYpiDdyi.js" as="script"><link rel="prefetch" href="/assets/xtls.html-CV2Gtzdb.js" as="script"><link rel="prefetch" href="/assets/dokodemo.html-OmKxMOmW.js" as="script"><link rel="prefetch" href="/assets/http.html-D6HTvq6N.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-yxp8ZJ8T.js" as="script"><link rel="prefetch" href="/assets/socks.html-CRfRvTEU.js" as="script"><link rel="prefetch" href="/assets/trojan.html-D14ojwSa.js" as="script"><link rel="prefetch" href="/assets/vless.html-tjaNg_CC.js" as="script"><link rel="prefetch" href="/assets/vmess.html-i62GRiNm.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-DHCtpKyp.js" as="script"><link rel="prefetch" href="/assets/blackhole.html-BFeXRPxF.js" as="script"><link rel="prefetch" href="/assets/dns.html-CIOVgaM1.js" as="script"><link rel="prefetch" href="/assets/freedom.html-7oS4oisI.js" as="script"><link rel="prefetch" href="/assets/http.html-DuNWIewI.js" as="script"><link rel="prefetch" href="/assets/loopback.html-DGmFNpfR.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-BcG-sgm0.js" as="script"><link rel="prefetch" href="/assets/socks.html-ETIIos1n.js" as="script"><link rel="prefetch" href="/assets/trojan.html-DtetaXIc.js" as="script"><link rel="prefetch" href="/assets/vless.html-_rFm-Mye.js" as="script"><link rel="prefetch" href="/assets/vmess.html-Ci-Hkphh.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-B4_GDHUb.js" as="script"><link rel="prefetch" href="/assets/grpc.html-BBufsXbI.js" as="script"><link rel="prefetch" href="/assets/h2.html-W9hGHr0s.js" as="script"><link rel="prefetch" href="/assets/httpupgrade.html-Brr1hfha.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-Vazy5-Uw.js" as="script"><link rel="prefetch" href="/assets/splithttp.html-B7nxcxwh.js" as="script"><link rel="prefetch" href="/assets/tcp.html-DEYtazip.js" as="script"><link rel="prefetch" href="/assets/websocket.html-bcvzO_SL.js" as="script"><link rel="prefetch" href="/assets/compile.html-IBS6pvSG.js" as="script"><link rel="prefetch" href="/assets/design.html-DHYZ6MRQ.js" as="script"><link rel="prefetch" href="/assets/guide.html-BC9kcbRS.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-aEnTphhV.js" as="script"><link rel="prefetch" href="/assets/muxcool.html-FJAwWqbd.js" as="script"><link rel="prefetch" href="/assets/vless.html-CQLCqop8.js" as="script"><link rel="prefetch" href="/assets/vmess.html-DzSSh6fw.js" as="script"><link rel="prefetch" href="/assets/index.html-CS3Lnxmy.js" as="script"><link rel="prefetch" href="/assets/ch01-preface.html-BKPUbBy4.js" as="script"><link rel="prefetch" href="/assets/ch02-preparation.html-fdJAkxu9.js" as="script"><link rel="prefetch" href="/assets/ch03-ssh.html-DyWjbAFw.js" as="script"><link rel="prefetch" href="/assets/ch04-security.html-Dar68GN-.js" as="script"><link rel="prefetch" href="/assets/ch05-webpage.html-efR8ra00.js" as="script"><link rel="prefetch" href="/assets/ch06-certificates.html-mETS6Gy5.js" as="script"><link rel="prefetch" href="/assets/ch07-xray-server.html-CTZgf4sN.js" as="script"><link rel="prefetch" href="/assets/ch08-xray-clients.html-BuGQij-o.js" as="script"><link rel="prefetch" href="/assets/ch09-appendix.html-BT0Em_6B.js" as="script"><link rel="prefetch" href="/assets/index.html-CWfw4i_l.js" as="script"><link rel="prefetch" href="/assets/fallbacks-lv1.html-CuzWkw31.js" as="script"><link rel="prefetch" href="/assets/fallbacks-with-sni.html-DCreFtR4.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part1.html-CPthkZmh.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part2.html-DwK1-ouE.js" as="script"><link rel="prefetch" href="/assets/work.html-CQPQrAh4.js" as="script"><link rel="prefetch" href="/assets/index.html-bHdFfUT4.js" as="script"><link rel="prefetch" href="/assets/iptables_gid.html-BJf5wegb.js" as="script"><link rel="prefetch" href="/assets/nginx_or_haproxy_tls_tunnel.html-BT7m2vcJ.js" as="script"><link rel="prefetch" href="/assets/redirect.html-BtA6Qouz.js" as="script"><link rel="prefetch" href="/assets/tproxy.html-Ci2UVKf5.js" as="script"><link rel="prefetch" href="/assets/tproxy_ipv4_and_ipv6.html-Dc2EvlDs.js" as="script"><link rel="prefetch" href="/assets/traffic_stats.html-BxGdDLQL.js" as="script"><link rel="prefetch" href="/assets/warp.html-B9KCA0Yh.js" as="script"><link rel="prefetch" href="/assets/browser_dialer.html-CZQ1VOVA.js" as="script"><link rel="prefetch" href="/assets/env.html-DF440WRI.js" as="script"><link rel="prefetch" href="/assets/fallback.html-B94DYbRH.js" as="script"><link rel="prefetch" href="/assets/multiple.html-ua3FS9RP.js" as="script"><link rel="prefetch" href="/assets/xtls.html-CF7kqvBJ.js" as="script"><link rel="prefetch" href="/assets/dokodemo.html-BORCcAkQ.js" as="script"><link rel="prefetch" href="/assets/http.html-D9TG5840.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-B7m_gwJs.js" as="script"><link rel="prefetch" href="/assets/socks.html-CH8TYCuV.js" as="script"><link rel="prefetch" href="/assets/trojan.html-hLH88O2k.js" as="script"><link rel="prefetch" href="/assets/vless.html-DK4SHLSq.js" as="script"><link rel="prefetch" href="/assets/vmess.html-DJb0OXE9.js" as="script"><link rel="prefetch" href="/assets/blackhole.html-B0QUS5cX.js" as="script"><link rel="prefetch" href="/assets/dns.html-DWgk4WAV.js" as="script"><link rel="prefetch" href="/assets/freedom.html-Bh9u-bC6.js" as="script"><link rel="prefetch" href="/assets/http.html-DbOV_vNO.js" as="script"><link rel="prefetch" href="/assets/loopback.html-ByWAkWC9.js" as="script"><link rel="prefetch" href="/assets/shadowsocks.html-BFPPIOYX.js" as="script"><link rel="prefetch" href="/assets/socks.html-ednjP_ux.js" as="script"><link rel="prefetch" href="/assets/trojan.html-CCawF659.js" as="script"><link rel="prefetch" href="/assets/vless.html-LCuEpSOz.js" as="script"><link rel="prefetch" href="/assets/vmess.html-4xDojTlF.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-BDoBaI7T.js" as="script"><link rel="prefetch" href="/assets/grpc.html-CFOQZdC-.js" as="script"><link rel="prefetch" href="/assets/h2.html-CuZDe0m8.js" as="script"><link rel="prefetch" href="/assets/httpupgrade.html-BjYaSl4O.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-BjaXm0yh.js" as="script"><link rel="prefetch" href="/assets/splithttp.html-CBpP0HHi.js" as="script"><link rel="prefetch" href="/assets/tcp.html-BK10AUvb.js" as="script"><link rel="prefetch" href="/assets/websocket.html-CoJgnV0p.js" as="script"><link rel="prefetch" href="/assets/compile.html-Cz9YuKqz.js" as="script"><link rel="prefetch" href="/assets/design.html-B9pgKA4R.js" as="script"><link rel="prefetch" href="/assets/guide.html-BQ4_UfKY.js" as="script"><link rel="prefetch" href="/assets/mkcp.html-DwH_X0ud.js" as="script"><link rel="prefetch" href="/assets/muxcool.html-DTOvNPxL.js" as="script"><link rel="prefetch" href="/assets/vless.html-BTd61etq.js" as="script"><link rel="prefetch" href="/assets/vmess.html-OxA-xnf5.js" as="script"><link rel="prefetch" href="/assets/index.html-C3AKEaom.js" as="script"><link rel="prefetch" href="/assets/ch01-preface.html-NAArHYBo.js" as="script"><link rel="prefetch" href="/assets/ch02-preparation.html-DaanoRyO.js" as="script"><link rel="prefetch" href="/assets/ch03-ssh.html-94LxfP-f.js" as="script"><link rel="prefetch" href="/assets/ch04-security.html-UoHk7Dfr.js" as="script"><link rel="prefetch" href="/assets/ch05-webpage.html-DbA3XLds.js" as="script"><link rel="prefetch" href="/assets/ch06-certificates.html-Rnav9JTO.js" as="script"><link rel="prefetch" href="/assets/ch08-xray-clients.html-BIoC7WGP.js" as="script"><link rel="prefetch" href="/assets/ch09-appendix.html-qFy3HXq2.js" as="script"><link rel="prefetch" href="/assets/index.html-qYi0vpRJ.js" as="script"><link rel="prefetch" href="/assets/fallbacks-lv1.html-BzOzX_u4.js" as="script"><link rel="prefetch" href="/assets/fallbacks-with-sni.html-5rIXzt4h.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part1.html-D--nu4Ge.js" as="script"><link rel="prefetch" href="/assets/routing-lv1-part2.html-DfIrAsfA.js" as="script"><link rel="prefetch" href="/assets/work.html-C6XjV73w.js" as="script"><link rel="prefetch" href="/assets/index.html-C2dNHhL_.js" as="script"><link rel="prefetch" href="/assets/iptables_gid.html-CXFrrGWV.js" as="script"><link rel="prefetch" href="/assets/nginx_or_haproxy_tls_tunnel.html-DPMBfl1c.js" as="script"><link rel="prefetch" href="/assets/redirect.html-D73k8Wqh.js" as="script"><link rel="prefetch" href="/assets/tproxy.html-CZMLkOBy.js" as="script"><link rel="prefetch" href="/assets/tproxy_ipv4_and_ipv6.html-CeydeTui.js" as="script"><link rel="prefetch" href="/assets/traffic_stats.html-BD4CXxyK.js" as="script"><link rel="prefetch" href="/assets/warp.html-BWAgEj6b.js" as="script"><link rel="prefetch" href="/assets/transparent_proxy.html-DCcsHank.js" as="script"><link rel="prefetch" href="/assets/transparent_proxy.html-OHdvuT7N.js" as="script"><link rel="prefetch" href="/assets/404.html-P8-RQZsR.js" as="script"><link rel="prefetch" href="/assets/wireguard.html-BCnG_KkS.js" as="script"><link rel="prefetch" href="/assets/Mermaid-zPVxsYXR.js" as="script"><link rel="prefetch" href="/assets/Tab-BfKP1L_2.js" as="script"><link rel="prefetch" href="/assets/Tabs-DZfMbieR.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="Переключить боковую панель" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/ru/" class=""><!----><span class="site-name" aria-hidden="true">Project X</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a href="/ru" class="router-link-active" aria-label="Главная"><!--[--><!--]--> Главная <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ru/about/news.md" class="" aria-label="История сайта"><!--[--><!--]--> История сайта <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ru/config/" class="" aria-label="Справочник по конфигурации"><!--[--><!--]--> Справочник по конфигурации <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ru/development/" class="" aria-label="Руководство разработчика"><!--[--><!--]--> Руководство разработчика <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ru/document/" class="router-link-active" aria-label="Быстрый старт"><!--[--><!--]--> Быстрый старт <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Русский / Change language"><span class="title">🌍 Русский / Change language</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Русский / Change language"><span class="title">🌍 Русский / Change language</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/document/level-0/ch07-xray-server.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/document/level-0/ch07-xray-server.html" class="" aria-label="English (WIP)"><!--[--><!--]--> English (WIP) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Русский (WIP)"><!--[--><!--]--> Русский (WIP) <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/xtls/xray-core" rel="noopener noreferrer" target="_blank" aria-label="Посмотреть исходный код"><!--[--><!--]--> Посмотреть исходный код <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Открыть в новой вкладке</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="Переключить цветовую схему"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a href="/ru" class="router-link-active" aria-label="Главная"><!--[--><!--]--> Главная <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ru/about/news.md" class="" aria-label="История сайта"><!--[--><!--]--> История сайта <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ru/config/" class="" aria-label="Справочник по конфигурации"><!--[--><!--]--> Справочник по конфигурации <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ru/development/" class="" aria-label="Руководство разработчика"><!--[--><!--]--> Руководство разработчика <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ru/document/" class="router-link-active" aria-label="Быстрый старт"><!--[--><!--]--> Быстрый старт <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Русский / Change language"><span class="title">🌍 Русский / Change language</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Русский / Change language"><span class="title">🌍 Русский / Change language</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/document/level-0/ch07-xray-server.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/document/level-0/ch07-xray-server.html" class="" aria-label="English (WIP)"><!--[--><!--]--> English (WIP) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Русский (WIP)"><!--[--><!--]--> Русский (WIP) <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/xtls/xray-core" rel="noopener noreferrer" target="_blank" aria-label="Посмотреть исходный код"><!--[--><!--]--> Посмотреть исходный код <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Открыть в новой вкладке</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Быстрый старт <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/ru/document/" class="router-link-active sidebar-item" aria-label="Быстрый старт"><!--[--><!--]--> Быстрый старт <!--[--><!--]--></a><!----></li><li><a href="/ru/document/install.html" class="sidebar-item" aria-label="Загрузка и установка"><!--[--><!--]--> Загрузка и установка <!--[--><!--]--></a><!----></li><li><a href="/ru/document/config.html" class="sidebar-item" aria-label="Настройка и запуск"><!--[--><!--]--> Настройка и запуск <!--[--><!--]--></a><!----></li><li><a href="/ru/document/command.html" class="sidebar-item" aria-label="Командные аргументы"><!--[--><!--]--> Командные аргументы <!--[--><!--]--></a><!----></li><li><a href="/ru/document/document.html" class="sidebar-item" aria-label="Вклад в документацию Project X"><!--[--><!--]--> Вклад в документацию Project X <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Простыми словами <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/ru/document/level-0/" class="router-link-active sidebar-item" aria-label="Простые разговоры о сложном"><!--[--><!--]--> Простые разговоры о сложном <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-0/ch01-preface.html" class="sidebar-item" aria-label="【Глава 1】 Простыми словами"><!--[--><!--]--> 【Глава 1】 Простыми словами <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-0/ch02-preparation.html" class="sidebar-item" aria-label="【Глава 2】 Подготовка"><!--[--><!--]--> 【Глава 2】 Подготовка <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-0/ch03-ssh.html" class="sidebar-item" aria-label="【Глава 3】 Удалённое подключение"><!--[--><!--]--> 【Глава 3】 Удалённое подключение <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-0/ch04-security.html" class="sidebar-item" aria-label="【Глава 4】 Обеспечение безопасности"><!--[--><!--]--> 【Глава 4】 Обеспечение безопасности <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-0/ch05-webpage.html" class="sidebar-item" aria-label="【Глава 5】 Создание веб-сайта"><!--[--><!--]--> 【Глава 5】 Создание веб-сайта <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-0/ch06-certificates.html" class="sidebar-item" aria-label="【Глава 6】 Управление сертификатами"><!--[--><!--]--> 【Глава 6】 Управление сертификатами <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="【Глава 7】Настройка Xray на сервере"><!--[--><!--]--> 【Глава 7】Настройка Xray на сервере <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-1-познать-многое-усвоить-нужное-копить-постепенно-тратить-осмотрительно" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.1 Познать многое, усвоить нужное; копить постепенно, тратить осмотрительно"><!--[--><!--]--> 7.1 Познать многое, усвоить нужное; копить постепенно, тратить осмотрительно <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-2-установка-xray" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2 Установка Xray"><!--[--><!--]--> 7.2 Установка Xray <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-3-установка-tls-сертификата-для-xray" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3 Установка TLS-сертификата для Xray"><!--[--><!--]--> 7.3 Установка TLS-сертификата для Xray <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-4-настроика-xray" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.4 Настройка Xray"><!--[--><!--]--> 7.4 Настройка Xray <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-5-запуск-xray-и-проверка-состояния-сервиса" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.5 Запуск Xray! (и проверка состояния сервиса)"><!--[--><!--]--> 7.5 Запуск Xray! (и проверка состояния сервиса) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-6-базовое-управление-сервисами-с-помощью-systemd" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.6 Базовое управление сервисами с помощью systemd"><!--[--><!--]--> 7.6 Базовое управление сервисами с помощью systemd <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-7-оптимизация-сервера-включение-bbr" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.7 Оптимизация сервера: включение BBR"><!--[--><!--]--> 7.7 Оптимизация сервера: включение BBR <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-8-оптимизация-сервера-автоматическое-перенаправление-http-на-https" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.8 Оптимизация сервера: автоматическое перенаправление HTTP на HTTPS"><!--[--><!--]--> 7.8 Оптимизация сервера: автоматическое перенаправление HTTP на HTTPS <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-9-оптимизация-сервера-более-гибкая-настроика-перенаправления" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.9 Оптимизация сервера: более гибкая настройка перенаправления"><!--[--><!--]--> 7.9 Оптимизация сервера: более гибкая настройка перенаправления <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-10-ваши-успехи" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.10 Ваши успехи"><!--[--><!--]--> 7.10 Ваши успехи <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/ru/document/level-0/ch07-xray-server.html#_7-11-важные-исправления" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.11 Важные исправления"><!--[--><!--]--> 7.11 Важные исправления <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/ru/document/level-0/ch08-xray-clients.html" class="sidebar-item" aria-label="【Глава 8】Настройка Xray на клиенте"><!--[--><!--]--> 【Глава 8】Настройка Xray на клиенте <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-0/ch09-appendix.html" class="sidebar-item" aria-label="[Глава 9] Приложение"><!--[--><!--]--> [Глава 9] Приложение <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Базовые навыки <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/ru/document/level-1/" class="sidebar-item" aria-label="Советы для начинающих"><!--[--><!--]--> Советы для начинающих <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-1/fallbacks-lv1.html" class="sidebar-item" aria-label="Обзор функции Fallback"><!--[--><!--]--> Обзор функции Fallback <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-1/routing-lv1-part1.html" class="sidebar-item" aria-label="Краткий обзор функции маршрутизации (routing) (часть 1)"><!--[--><!--]--> Краткий обзор функции маршрутизации (routing) (часть 1) <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-1/routing-lv1-part2.html" class="sidebar-item" aria-label="Краткий обзор функции маршрутизации (routing) (часть 2)"><!--[--><!--]--> Краткий обзор функции маршрутизации (routing) (часть 2) <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-1/work.html" class="sidebar-item" aria-label="Режимы работы Xray"><!--[--><!--]--> Режимы работы Xray <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-1/fallbacks-with-sni.html" class="sidebar-item" aria-label="SNI Fallback"><!--[--><!--]--> SNI Fallback <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Продвинутые навыки <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/ru/document/level-2/" class="sidebar-item" aria-label="Продвинутая документация"><!--[--><!--]--> Продвинутая документация <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-2/transparent_proxy/transparent_proxy.html" class="sidebar-item" aria-label="Другие замечания по прозрачному проксированию с помощью iptables"><!--[--><!--]--> Другие замечания по прозрачному проксированию с помощью iptables <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-2/tproxy.html" class="sidebar-item" aria-label="Прозрачное проксирование TProxy"><!--[--><!--]--> Прозрачное проксирование TProxy <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-2/tproxy_ipv4_and_ipv6.html" class="sidebar-item" aria-label="Прозрачное проксирование TProxy (ipv4 и ipv6)"><!--[--><!--]--> Прозрачное проксирование TProxy (ipv4 и ipv6) <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-2/nginx_or_haproxy_tls_tunnel.html" class="sidebar-item" aria-label="Создание TLS-туннеля с помощью Nginx или Haproxy для скрытия отпечатков"><!--[--><!--]--> Создание TLS-туннеля с помощью Nginx или Haproxy для скрытия отпечатков <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-2/iptables_gid.html" class="sidebar-item" aria-label="GID Прозрачное проксирование"><!--[--><!--]--> GID Прозрачное проксирование <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-2/redirect.html" class="sidebar-item" aria-label="Перенаправление исходящего трафика"><!--[--><!--]--> Перенаправление исходящего трафика <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-2/warp.html" class="sidebar-item" aria-label="Повышение безопасности проксирования с помощью Cloudflare Warp"><!--[--><!--]--> Повышение безопасности проксирования с помощью Cloudflare Warp <!--[--><!--]--></a><!----></li><li><a href="/ru/document/level-2/traffic_stats.html" class="sidebar-item" aria-label="Статистика трафика"><!--[--><!--]--> Статистика трафика <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><!--v-if--><h1 id="【глава-7】настроика-xray-на-сервере" tabindex="-1"><a class="header-anchor" href="#【глава-7】настроика-xray-на-сервере"><span>【Глава 7】Настройка Xray на сервере</span></a></h1><h2 id="_7-1-познать-многое-усвоить-нужное-копить-постепенно-тратить-осмотрительно" tabindex="-1"><a class="header-anchor" href="#_7-1-познать-многое-усвоить-нужное-копить-постепенно-тратить-осмотрительно"><span>7.1 Познать многое, усвоить нужное; копить постепенно, тратить осмотрительно</span></a></h2><p>Во время написания этого руководства один знакомый в шутку заметил: &quot;Твое руководство уже 6 глав публикуется, а до Xray всё никак не дойдёт. Кто не знает, подумает, что это руководство &quot;Создание сайта с нуля&quot;. (И ведь не поспоришь! 😂)</p><p>На самом деле такая структура — результат моего осознанного решения. Ведь только заложив прочный фундамент, можно в дальнейшем двигаться вперёд семимильными шагами. Я видел в чатах много новичков, которые не могут правильно использовать даже <code>nano</code>, не говоря уже о <code>WinSCP</code>. Из-за этого их <code>config.json</code>, написанные вручную на удалённом сервере, пестрят ошибками, а поиск и исправление этих ошибок превращается в мучение.</p><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Пройдя первые 6 глав, мы вместе с вами преодолели несколько важных этапов: освоили базовые операции Linux, научились удалённо управлять VPS, разобрались с установкой веб-сервера, управлением доменными именами, получением SSL-сертификатов. Оглядываясь назад, разве всё это кажется таким уж сложным? Теперь, имея такой солидный багаж знаний, мы подойдём к установке и настройке Xray с чувством лёгкости и уверенности, ведь всё уже готово!</p></div><p>Дальнейшие шаги предельно просты:</p><ol><li>Установка</li><li>Настройка (например, установка TLS-сертификата, настройка <code>config.json</code>)</li><li>Запуск</li><li>Оптимизация (например, обновление ядра, включение <code>bbr</code>, автоматическое перенаправление <code>http</code>-запросов на <code>https</code> и т. д.)</li></ol><h2 id="_7-2-установка-xray" tabindex="-1"><a class="header-anchor" href="#_7-2-установка-xray"><span>7.2 Установка Xray</span></a></h2><p>Xray основан на проекте с открытым исходным кодом <a href="https://github.com/XTLS/Xray-core" target="_blank" rel="noopener noreferrer">xray-core<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Открыть в новой вкладке</span></span></a> (лицензия <code>MPL 2.0</code>). Запущенный на сервере, скомпилированный бинарный файл этого проекта, работает как серверная часть Xray; запущенный на локальном компьютере, он становится клиентской частью. Основное различие заключается в <strong>конфигурации</strong>.</p><p>Для установки воспользуемся официальным скриптом. Он предлагает несколько вариантов установки. Вы можете ознакомиться с ними в <a href="https://github.com/XTLS/Xray-install" target="_blank" rel="noopener noreferrer">репозитории скриптов<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Открыть в новой вкладке</span></span></a>. <strong>В данном руководстве мы будем использовать установку от имени непривилегированного пользователя</strong>.</p><p>На момент написания руководства в скрипте есть небольшая ошибка при установке от имени непривилегированного пользователя, поэтому мы выполним эти шаги вручную. Заодно рассмотрим команду удаления файлов в Linux.</p><ol><li><p>Базовые команды Linux:</p><table><thead><tr><th style="text-align:center;">Номер</th><th style="text-align:center;">Команда</th><th style="text-align:left;">Описание</th></tr></thead><tbody><tr><td style="text-align:center;"><code>cmd-14</code></td><td style="text-align:center;"><code>rm</code></td><td style="text-align:left;">Удаление файлов</td></tr></tbody></table></li><li><p>Скачиваем установочный скрипт:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/XTLS/Xray-install/raw/main/install-release.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Запускаем установку:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">bash</span> install-release.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>После завершения установки удаляем скрипт:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">rm</span> ~/install-release.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>При использовании команды <code>rm</code> для удаления файлов по умолчанию подразумевается удаление файлов в текущей директории. Однако <strong>я всё же указал полный путь</strong>: <code>~/install-release.sh</code>. Это моя привычка, которая повышает безопасность при использовании <code>rm</code>. Думаю, вы слышали истории про &quot;программиста, который удалил базу данных и сбежал&quot;. 😉</p></div></li><li><p>Весь процесс показан на гифке:</p><p><img src="/assets/ch07-img01-xray-install-6RUithnp.gif" alt="Процесс установки Xray на сервер"></p></li></ol><h2 id="_7-3-установка-tls-сертификата-для-xray" tabindex="-1"><a class="header-anchor" href="#_7-3-установка-tls-сертификата-для-xray"><span>7.3 Установка TLS-сертификата для Xray</span></a></h2><p>Хотя мы уже получили TLS-сертификат, согласно <a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E#3-copy%E5%AE%89%E8%A3%85-%E8%AF%81%E4%B9%A6" target="_blank" rel="noopener noreferrer">официальной документации <code>acme.sh</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Открыть в новой вкладке</span></span></a>, не рекомендуется использовать полученные файлы сертификата напрямую. Правильный способ — использовать команду <code>--install-cert</code> для установки сертификата для нужного приложения. Давайте установим сертификат для <code>xray-core</code>.</p><ol><li><p>Чтобы избежать проблем с правами доступа при работе от имени непривилегированного пользователя, создадим папку для сертификатов в домашней директории пользователя <code>vpsadmin</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> ~/xray_cert
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Используем команду <code>--install-cert</code> из <code>acme.sh</code> для установки (копирования) файлов сертификата:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>acme.sh --install-cert <span class="token parameter variable">-d</span> sub.yourdomain.com <span class="token parameter variable">--ecc</span> <span class="token punctuation">\</span>
           --fullchain-file ~/xray_cert/xray.crt <span class="token punctuation">\</span>
           --key-file ~/xray_cert/xray.key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>По умолчанию файл <code>xray.key</code> недоступен для чтения другим пользователям, поэтому нужно выдать права на чтение:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">chmod</span> +r ~/xray_cert/xray.key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Процесс довольно простой, поэтому обойдёмся без гифки:</p><p><img src="/assets/ch07-img02-xray-cert-install-BVo1KeA2.png" alt="Установка сертификата для Xray"></p></li><li><p><code>acme.sh</code> проверяет срок действия сертификата каждые 60 дней и автоматически обновляет его при необходимости. Однако, насколько мне известно, он не устанавливает новый сертификат для <code>xray-core</code> автоматически. Поэтому нам нужно добавить автоматическое задание cron, которое будет делать это за нас.</p><ol><li><p>Базовые команды Linux:</p><table><thead><tr><th style="text-align:center;">Номер</th><th style="text-align:center;">Команда</th><th style="text-align:left;">Описание</th></tr></thead><tbody><tr><td style="text-align:center;"><code>cmd-15</code></td><td style="text-align:center;"><code>crontab -e</code></td><td style="text-align:left;">Редактирование crontab текущего пользователя</td></tr></tbody></table></li><li><p>Создаём файл скрипта (<code>xray-cert-renew.sh</code>):</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">nano</span> ~/xray_cert/xray-cert-renew.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Копируем в него следующий код, заменив <code>sub.yourdomain.com</code> на своё доменное имя, и сохраняем файл:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

/home/vpsadmin/.acme.sh/acme.sh --install-cert <span class="token parameter variable">-d</span> sub.yourdomain.com <span class="token parameter variable">--ecc</span> --fullchain-file /home/vpsadmin/xray_cert/xray.crt --key-file /home/vpsadmin/xray_cert/xray.key
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Xray Certificates Renewed&quot;</span>

<span class="token function">chmod</span> +r /home/vpsadmin/xray_cert/xray.key
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Read Permission Granted for Private Key&quot;</span>

<span class="token function">sudo</span> systemctl restart xray
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Xray Restarted&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Как заметили пользователи, <code>acme.sh</code> имеет команду <code>reloadcmd</code>, которая позволяет выполнить произвольную команду после обновления сертификата. Таким образом, можно настроить автоматическую установку сертификата для <code>Xray</code>. Однако, поскольку <code>crontab</code> — очень полезный и часто используемый инструмент в Linux, в данном руководстве мы будем использовать его для обновления сертификата <code>Xray</code>. (Подробнее о команде <code>reloadcmd</code> можно прочитать в <a href="https://github.com/acmesh-official/acme.sh" target="_blank" rel="noopener noreferrer">документации <code>acme.sh</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Открыть в новой вкладке</span></span></a>).</p><p>Кроме того, в момент записи гифки в скрипт не была добавлена команда перезапуска <code>Xray</code>, поскольку в планах разработчиков <code>Xray</code> — поддержка <strong>горячего обновления сертификатов</strong>. Это означает, что <code>Xray</code> сможет автоматически обнаруживать обновление сертификата и перезагружать его без необходимости перезапуска. После добавления этой функции я обновлю конфигурацию <code>config.json</code>, включив эту настройку, и удалю команду перезапуска из скрипта.</p></div></li><li><p>Делаем скрипт исполняемым:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">chmod</span> +x ~/xray_cert/xray-cert-renew.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Запускаем <code>crontab -e</code>, чтобы добавить задание на автоматическое выполнение <code>xray-cert-renew.sh</code> каждый месяц (не используйте <code>sudo</code>, так как мы добавляем задание для пользователя <code>vpsadmin</code>. При первом запуске <code>crontab</code> вам будет предложено выбрать редактор. Выбираем знакомый нам <code>nano</code>!):</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">crontab</span> <span class="token parameter variable">-e</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Добавляем следующую строку в конец файла и сохраняем его:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 1:00am, 1st day each month, run `xray-cert-renew.sh`
0 1 1 * *   bash /home/vpsadmin/xray_cert/xray-cert-renew.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Весь процесс показан на гифке:</p><p><img src="/assets/ch07-img03-crontab-cert-renew-B_dwSLtg.gif" alt="Автоматическая установка сертификата для Xray каждый месяц"></p></li></ol></li></ol><h2 id="_7-4-настроика-xray" tabindex="-1"><a class="header-anchor" href="#_7-4-настроика-xray"><span>7.4 Настройка Xray</span></a></h2><p>Для начала можете ознакомиться с <a href="https://github.com/XTLS/Xray-examples" target="_blank" rel="noopener noreferrer">примерами конфигурации VLESS<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Открыть в новой вкладке</span></span></a>. В этом руководстве мы будем использовать официальный пример для настройки максимально простого варианта: <strong>один входящий прокси-сервер VLESS + перенаправление с порта 80</strong>. Такая конфигурация обеспечит максимальную скорость и необходимый уровень безопасности в большинстве случаев.</p><ol><li><p>Генерируем валидный <code>UUID</code> и сохраняем его (грубо говоря, <code>UUID</code> — это уникальный идентификатор, который можно сравнить с отпечатком пальца):</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>xray uuid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Создаём файлы и папки для логов:</p><ol><li><p>Базовые команды Linux:</p><table><thead><tr><th style="text-align:center;">Номер</th><th style="text-align:center;">Команда</th><th style="text-align:left;">Описание</th></tr></thead><tbody><tr><td style="text-align:center;"><code>cmd-16</code></td><td style="text-align:center;"><code>touch</code></td><td style="text-align:left;">Создание пустого файла</td></tr></tbody></table></li><li><p>Создаём папку для логов в домашней директории пользователя <code>vpsadmin</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> ~/xray_log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Создаём два файла для логов (логи доступа и логи ошибок):</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">touch</span> ~/xray_log/access.log <span class="token operator">&amp;&amp;</span> <span class="token function">touch</span> ~/xray_log/error.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Это не стандартное расположение файлов логов <code>Xray</code>. Мы используем его, чтобы избежать проблем с правами доступа, которые могут возникнуть у новичков. Когда разберётесь, рекомендуется использовать стандартные пути: <code>/var/log/xray/access.log</code> и <code>/var/log/xray/error.log</code>.</p></div></li><li><p>По умолчанию Xray запускается от имени пользователя <code>nobody</code>, поэтому нужно дать другим пользователям права на запись в файлы логов (<code>*.log</code> — это все файлы с расширением <code>log</code>. Здесь проявляются преимущества использования командной строки):</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">chmod</span> a+w ~/xray_log/*.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li><li><p>Создаём файл конфигурации <code>Xray</code> с помощью <code>nano</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /usr/local/etc/xray/config.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Копируем в него следующий код и вставляем сгенерированный ранее <code>UUID</code> в строку 61: <code>&quot;id&quot;: &quot;&quot;,</code> (должно получиться что-то вроде <code>&quot;id&quot;: &quot;uuiduuid-uuid-uuid-uuid-uuiduuiduuid&quot;</code>). В этом файле конфигурации я добавил свои комментарии, чтобы вам было проще понять, за что отвечает каждый модуль.</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token comment">// ССЫЛКИ:</span>
<span class="token comment">// https://github.com/XTLS/Xray-examples</span>
<span class="token comment">// https://xtls.github.io/config/</span>
<span class="token comment">// Типичный конфигурационный файл, как для сервера, так и для клиента, состоит из 5 основных частей. Разберём их по полочкам:</span>
<span class="token comment">// ┌─ 1_log Настройки логирования - что и куда писать в лог (чтобы было проще искать ошибки)</span>
<span class="token comment">// ├─ 2_dns Настройки DNS - как выполнять DNS-запросы (защита от DNS-спуфинга, защита от слежки, предотвращение маршрутизации трафика на китайские серверы и т. д.)</span>
<span class="token comment">// ├─ 3_routing Настройки маршрутизации - как обрабатывать трафик (фильтрация рекламы, разделение трафика для разных стран)</span>
<span class="token comment">// ├─ 4_inbounds Настройки входящих подключений - какой трафик может поступать на Xray</span>
<span class="token comment">// └─ 5_outbounds Настройки исходящих подключений - куда направлять трафик, исходящий от Xray</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 1_Настройки логирования</span>
  <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;loglevel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Уровень детализации логов: &quot;none&quot;, &quot;error&quot;, &quot;warning&quot;, &quot;info&quot;, &quot;debug&quot; (от меньшего к большему)</span>
    <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/home/vpsadmin/xray_log/access.log&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Файл для записи логов доступа</span>
    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/home/vpsadmin/xray_log/error.log&quot;</span> <span class="token comment">// Файл для записи логов ошибок</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 2_Настройки DNS</span>
  <span class="token property">&quot;dns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;servers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;https+local://1.1.1.1/dns-query&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Используем DoH-сервер 1.1.1.1 в первую очередь. Это снижает скорость, но защищает от слежки со стороны интернет-провайдера</span>
      <span class="token string">&quot;localhost&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 3_Настройки маршрутизации</span>
  <span class="token property">&quot;routing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;domainStrategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IPIfNonMatch&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 3.1 Предотвращение проблем с локальной маршрутизацией: атаки на внутреннюю сеть, неправильная обработка локальных адресов и т. д.</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;geoip:private&quot;</span> <span class="token comment">// Условие: адреса из списка &quot;private&quot; в файле geoip (локальные адреса)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;block&quot;</span> <span class="token comment">// Действие: отправить трафик на исходящее подключение &quot;block&quot; (блокировка)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 3.2 Предотвращение прямого подключения к китайским серверам</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;geoip:cn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;block&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 3.3 Блокировка рекламы</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;geosite:category-ads-all&quot;</span> <span class="token comment">// Условие: домены из списка &quot;category-ads-all&quot; в файле geosite (рекламные домены)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;block&quot;</span> <span class="token comment">// Действие: отправить трафик на исходящее подключение &quot;block&quot; (блокировка)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 4_Настройки входящих подключений</span>
  <span class="token comment">// 4.1 Здесь указан только один простейший входящий прокси-сервер vless+xtls, так как это самый производительный режим Xray. При необходимости вы можете добавить другие прокси-серверы, используя этот шаблон.</span>
  <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vless&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;clients&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Укажите свой UUID</span>
            <span class="token property">&quot;flow&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xtls-rprx-vision&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vpsadmin@yourdomain.com&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;decryption&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;fallbacks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token number">80</span> <span class="token comment">// Перенаправлять на порт 80 по умолчанию</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;streamSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tls&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;tlsSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;alpn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http/1.1&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;certificates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token property">&quot;certificateFile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/home/vpsadmin/xray_cert/xray.crt&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;keyFile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/home/vpsadmin/xray_cert/xray.key&quot;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 5_Настройки исходящих подключений</span>
  <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 5.1 Первое исходящее подключение - это правило по умолчанию. freedom - это прямое подключение (VPS и так находится во внешней сети)</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;freedom&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 5.2 Правило блокировки. Протокол blackhole отправляет трафик в никуда (блокирует его)</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;block&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blackhole&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Весь процесс показан на гифке:</p><p><img src="/assets/ch07-img04-xray-log-and-config-BP5ccZ8k.gif" alt="Создание файлов логов и файла конфигурации "></p></li></ol><h2 id="_7-5-запуск-xray-и-проверка-состояния-сервиса" tabindex="-1"><a class="header-anchor" href="#_7-5-запуск-xray-и-проверка-состояния-сервиса"><span>7.5 Запуск Xray! (и проверка состояния сервиса)</span></a></h2><p>Если вы всё делали по инструкции, то должны были избежать двух самых распространённых ошибок: <strong>недостаточно прав для записи в файлы логов</strong> и <strong>недостаточно прав для чтения файлов сертификата</strong>. Так что запуск <code>Xray</code> должен пройти без сучка и задоринки.</p><ol><li><p>Вводим команду и наслаждаемся историческим моментом запуска <code>Xray</code>!!!</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start xray
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Однако просто выполнить команду <code>start</code> недостаточно, чтобы убедиться, что сервис <code>Xray</code> запущен и работает корректно. Для проверки состояния сервиса используем следующую команду:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl status xray
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Видите надпись зелёного цвета <code>active (running)</code>? Это означает, что <code>Xray</code> запущен и работает.</p></li><li><p>Весь процесс показан на гифке:</p><p><img src="/assets/ch07-img05-xray-start-and-status-Cl6yKbrT.gif" alt="Запуск и проверка состояния сервиса Xray"></p></li></ol><h2 id="_7-6-базовое-управление-сервисами-с-помощью-systemd" tabindex="-1"><a class="header-anchor" href="#_7-6-базовое-управление-сервисами-с-помощью-systemd"><span>7.6 Базовое управление сервисами с помощью <code>systemd</code></span></a></h2><p>Мы уже использовали несколько команд <code>systemctl</code>: <code>start</code>, <code>status</code>, <code>reload</code>. Все эти команды используются для управления сервисами в Linux с помощью системы инициализации <code>systemd</code>. Давайте рассмотрим ещё несколько полезных команд.</p><ol><li><p>Чтобы временно остановить сервис <code>Xray</code>, используем команду <code>stop</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl stop xray
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Чтобы перезапустить сервис <code>Xray</code>, используем команду <code>restart</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl restart xray
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Чтобы запретить автозапуск сервиса <code>Xray</code> после перезагрузки, используем команду <code>disable</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl disable xray
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Чтобы разрешить автозапуск сервиса <code>Xray</code> после перезагрузки, используем команду <code>enable</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> xray
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h2 id="_7-7-оптимизация-сервера-включение-bbr" tabindex="-1"><a class="header-anchor" href="#_7-7-оптимизация-сервера-включение-bbr"><span>7.7 Оптимизация сервера: включение BBR</span></a></h2><ol><li>Что говорят о <code>BBR</code></li></ol><p>Уверен, что, изучая различные способы обхода блокировок, вы не раз сталкивались с аббревиатурой <code>bbr</code>. В многочисленных блогах её расхваливают на все лады, наделяя чуть ли не магическими свойствами. Существуют также различные модификации, такие как <code>bbrplus</code>, <code>bbr2</code>, <code>магически модифицированный bbr</code> и т. д. Создаётся ощущение, что это какая-то волшебная палочка, которая превращает тыкву в карету, а медленный интернет — в сверхскоростной.</p><p>Так что же такое <code>BBR</code> на самом деле? Действительно ли он так хорош? И какую версию использовать?</p><ol start="2"><li><code>BBR</code> на самом деле</li></ol><p><strong>BBR</strong> = <strong>B</strong>ottleneck <strong>B</strong>andwidth and <strong>R</strong>ound-trip propagation time — это алгоритм управления перегрузками для протокола TCP. Проще говоря, это <strong>регулировщик дорожного движения для интернет-трафика</strong>: когда на дороге нет пробок, каждая машина может двигаться с максимальной скоростью.</p><p>Так работает ли он? Как правило, разница между включенным и выключенным <code>BBR</code> заметна (улучшается скорость, стабильность и снижается пинг), поэтому <strong>настоятельно рекомендуется включить <code>BBR</code></strong>.</p><p>Однако разница между версиями <code>BBR</code> для ядер 4.x и 5.x зачастую не столь существенна и зависит от конкретной ситуации. Решающим фактором, влияющим на качество связи, по-прежнему остаётся качество самого интернет-канала. Поэтому <strong>не стоит гнаться за новейшими версиями <code>BBR</code>. Достаточно использовать версию, которая поставляется с вашей версией дистрибутива Linux</strong>.</p><ol start="3"><li>Действительно ли <code>bbrplus</code>, <code>bbr2</code>, <code>магически модифицированный bbr</code> и другие версии с крутыми названиями лучше?</li></ol><p>Одним словом: <strong>нет! Не используйте их! Все эти названия придуманы только для привлечения внимания!</strong></p><p>Обновления <code>BBR</code> выпускаются вместе с обновлениями ядра Linux (<code>Kernel</code>). Другими словами, если вы используете относительно новое ядро, то у вас уже будет установлена последняя версия <code>BBR</code>.</p><p>А все эти скрипты с крутыми названиями просто скачивают и устанавливают предварительные версии ядра (или даже модифицированные сторонними разработчиками версии) с более новыми версиями <code>BBR</code>.</p><p>Стабильность ядра — это основа стабильной работы сервера. <strong>Незначительное повышение производительности, которое могут дать тестовые версии <code>BBR</code>, не стоит того, чтобы рисковать стабильностью сервера.</strong> Используйте последнюю версию ядра, которая поддерживается вашим дистрибутивом Linux. Это обеспечит максимальную стабильность и совместимость вашего сервера.</p><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Так называемое &quot;преимущество&quot; модифицированных версий <code>bbr</code> <strong>очень недолговечно</strong>. Например, многие скрипты <code>bbrplus</code> до сих пор устанавливают ядро версии 4.19, поскольку не обновлялись уже несколько лет. А ведь на дворе уже эпоха Debian 11 с ядром 5.10! То есть, если в январе 2018 года этот скрипт, возможно, и давал какое-то преимущество, то уже к октябрю 2018 года, когда вышла стабильная версия ядра 4.19, он потерял всякий смысл. А сейчас его использование и вовсе можно назвать <strong>даунгрейдом</strong>.</p></div><ol start="4"><li>Какой алгоритм управления очередями использовать: <code>fq</code>, <code>fq_codel</code>, <code>fq_pie</code>, <code>cake</code> или какой-то другой?</li></ol><p>Одним словом: <strong>если не знаете, что выбрать, оставьте <code>fq</code>. Этого достаточно, и это не ухудшит качество связи</strong>.</p><ol start="5"><li>Стоит ли использовать &quot;ускорители&quot; типа <strong>锐速</strong>, <strong>Finalspeed</strong>, <strong>LotServer</strong>?</li></ol><p>Одним словом: <strong>нет! Забудьте о них, как о страшном сне!</strong></p><p>Единственная проблема, которую они решают, — это проблема потери пакетов. Если проводить аналогию, то представьте, что вам нужно отправить груз, но машина, которая его везёт, иногда ломается по дороге (теряются пакеты). Эти &quot;ускорители&quot; просто отправляют три одинаковых груза на трёх машинах одновременно. Даже если две машины сломаются, третья всё равно доставит груз. Конечно, если на дороге будет много ваших машин, то вы будете создавать помехи другим участникам движения. Но и они будут создавать помехи вам. А поскольку пропускная способность канала ограничена, то в итоге все будут стоять в пробке.</p><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Эти &quot;ускорители&quot; не оптимизируют алгоритмы и не увеличивают скорость соединения. В большинстве своём это просто <strong>увеличители количества отправляемых пакетов</strong>. Для каналов с <strong>очень высокими потерями пакетов</strong> они могут дать незначительный эффект, но <strong>для хороших каналов с низкими потерями пакетов они бесполезны и даже вредны, поскольку увеличивают расход трафика</strong>. Это создаёт ненужную нагрузку на сервер и на каналы других пользователей.</p><p>Если у вас действительно плохой канал с высокими потерями пакетов, то единственное правильное решение — <strong>сменить провайдера</strong>.</p></div><ol start="6"><li><p>Я так подробно остановился на <code>BBR</code>, потому что вокруг него слишком много мифов и откровенной дезинформации, нацеленной на новичков. Надеюсь, теперь у вас есть чёткое представление о том, что такое <code>BBR</code> и как он работает. А теперь давайте установим последнюю версию ядра Debian и включим <code>BBR</code>! (Это действительно просто)</p><ol><li><p>Добавляем репозиторий <code>backports</code> в Debian 10, чтобы получить доступ к более новым версиям пакетов:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /etc/apt/sources.list
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>В Debian 10 можно без проблем использовать файл <code>/etc/apt/sources.list</code>. Однако, если вы используете другой дистрибутив Linux или не устанавливали систему с нуля по этой инструкции, то рекомендуется создать папку <code>/etc/apt/sources.list.d/</code> и добавлять свои файлы конфигурации в неё, например, <code>/etc/apt/sources.list.d/vpsadmin.list</code>. Это обеспечит совместимость с другими дистрибутивами и предотвратит потерю настроек при случайном перезаписывании файла <code>/etc/apt/sources.list</code>.</p></div></li><li><p>Добавляем следующую строку в конец файла и сохраняем его:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>deb http://archive.debian.org/debian buster-backports main
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Обновляем список доступных пакетов, ищем последнюю версию ядра Debian и устанавливаем её. Устанавливайте версию ядра, которая подходит для вашей архитектуры (в данном руководстве мы используем <code>amd64</code>):</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token parameter variable">-t</span> buster-backports <span class="token function">install</span> linux-image-amd64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>Если ваш VPS поддерживает это, вы можете попробовать установить <strong>специальное ядро для облачных серверов</strong> <code>linux-image-cloud-amd64</code>. Его преимущества — это меньший размер и меньшее потребление ресурсов. Однако некоторые пользователи сталкивались с проблемами при установке этого ядра на неподдерживаемые системы, вплоть до невозможности загрузки (ядро не определялось).</p><p>Чтобы не попасть в такую ситуацию, перед установкой этого ядра:</p><ul><li>создайте снапшот системы или</li><li>убедитесь, что у вас есть доступ к <code>vnc</code>-консоли (и вы знаете, как ей пользоваться)</li></ul></div></li><li><p>Редактируем файл конфигурации <code>sysctl.conf</code> и включаем <code>BBR</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /etc/sysctl.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">Внимание</p><p>В Debian 10 можно без проблем использовать файл <code>/etc/sysctl.conf</code>. Однако, если вы используете другой дистрибутив Linux или не устанавливали систему с нуля по этой инструкции, то рекомендуется создать папку <code>/etc/sysctl.d/</code> и добавлять свои файлы конфигурации в неё, например, <code>/etc/sysctl.d/vpsadmin.conf</code>. Это обеспечит совместимость с другими дистрибутивами, поскольку в некоторых из них, начиная с версии <code>systemd</code> 207, параметры из файла <code>/etc/sysctl.conf</code> не читаются. Использование отдельного файла конфигурации также предотвратит потерю настроек при случайном перезаписывании файла <code>/etc/sysctl.conf</code>.</p></div></li><li><p>Добавляем следующие строки в конец файла:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>net.core.default_qdisc=fq
net.ipv4.tcp_congestion_control=bbr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Перезагружаем VPS, чтобы изменения вступили в силу:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">reboot</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Весь процесс показан на гифке:</p><div class="custom-container tip"><p class="custom-container-title">Подсказка</p><p>На моём VPS поддерживается специальное ядро для облачных серверов, поэтому на гифке я устанавливаю <code>linux-image-cloud-amd64</code>. Если вы не уверены, поддерживается ли оно на вашем VPS, то установите обычное ядро <code>linux-image-amd64</code>, как показано в пункте 3.</p></div><p><img src="/assets/ch07-img06-bbr-proper-BpzfpFMr.gif" alt="Обновление ядра Debian и включение "></p></li><li><p>Проверяем, что <code>BBR</code> включен</p><p>Чтобы убедиться, что модуль <code>BBR</code> загружен, выполните команду:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>lsmod <span class="token operator">|</span> <span class="token function">grep</span> bbr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>В результате вы должны увидеть что-то вроде этого:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>tcp_bbr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Чтобы убедиться, что алгоритм <code>fq</code> используется, выполните команду:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>lsmod <span class="token operator">|</span> <span class="token function">grep</span> fq
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>В результате вы должны увидеть что-то вроде этого:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sch_fq
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li></ol><h2 id="_7-8-оптимизация-сервера-автоматическое-перенаправление-http-на-https" tabindex="-1"><a class="header-anchor" href="#_7-8-оптимизация-сервера-автоматическое-перенаправление-http-на-https"><span>7.8 Оптимизация сервера: автоматическое перенаправление HTTP на HTTPS</span></a></h2><ol><li><p>Ранее мы настроили веб-сервер на порту 80 и получили TLS-сертификат.</p><p>Однако, если вы попытаетесь открыть наш сайт по протоколу HTTP, то заметите, что он не перенаправляется автоматически на HTTPS, как это делают большинство сайтов. Другими словами, в нашей текущей конфигурации HTTP (порт 80) и HTTPS (порт 443) — это два совершенно независимых сайта. Чтобы это исправить, нужно внести некоторые изменения.</p></li><li><p>Открываем файл конфигурации Nginx:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /etc/nginx/nginx.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>В настройках сервера, который слушает порт 80, добавляем следующую строку и сохраняем файл (строки <code>root</code> и <code>index</code> можно удалить):</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>return 301 https://$http_host$request_uri;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Добавляем новый сервер, который будет прослушивать локальный порт и отдавать файлы сайта. В данном примере мы будем использовать порт 8080 (вы можете использовать любой другой порт):</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>server {
    listen 127.0.0.1:8080;
    root /home/vpsadmin/www/webpage;
    index index.html;
    add_header Strict-Transport-Security &quot;max-age=63072000&quot; always;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Перезапускаем Nginx:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl restart nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Изменяем настройки перенаправления в файле конфигурации Xray, заменив порт 80 на 8080 (находим <code>&quot;dest&quot;: 80</code> и меняем на <code>&quot;dest&quot;: 8080</code>):</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /usr/local/etc/xray/config.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Перезапускаем Xray:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl restart xray
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Весь процесс показан на гифке:</p><p><img src="/assets/ch07-img07-http-to-https-QYIcd_gO.gif" alt="Автоматическое перенаправление HTTP на HTTPS"></p></li><li><p>Теперь, если вы попытаетесь открыть сайт по адресу <code>http://sub.yourdomain.com</code>, он должен автоматически перенаправиться на HTTPS:</p><p><img src="/assets/ch07-img08-http-to-https-check-7ZPa5fw-.png" alt="Проверка автоматического перенаправления HTTP на HTTPS"></p></li></ol><h2 id="_7-9-оптимизация-сервера-более-гибкая-настроика-перенаправления" tabindex="-1"><a class="header-anchor" href="#_7-9-оптимизация-сервера-более-гибкая-настроика-перенаправления"><span>7.9 Оптимизация сервера: более гибкая настройка перенаправления</span></a></h2><p>Если вам нужны более гибкие настройки перенаправления, обратитесь к статье <a href="/ru/document/level-1/fallbacks-lv1/" class="">«Разбор функции Fallback»</a>.</p><h2 id="_7-10-ваши-успехи" tabindex="-1"><a class="header-anchor" href="#_7-10-ваши-успехи"><span>7.10 Ваши успехи</span></a></h2><p>Поздравляю! На этом этапе у вас есть работающий сервер с обходом блокировок и сайт-приманка, который защитит вас от сканирования. Теперь достаточно установить клиентское приложение на ваше устройство — и можно наслаждаться свободным интернетом!</p><blockquote><p>⬛⬛⬛⬛⬛⬛⬛⬜ 87.5%</p></blockquote><h2 id="_7-11-важные-исправления" tabindex="-1"><a class="header-anchor" href="#_7-11-важные-исправления"><span>7.11 Важные исправления</span></a></h2><ol><li><p>В первоначальной версии руководства был указан неверный путь к файлу конфигурации <code>Xray</code> (<code>config.json</code>). Если вы настроили <code>Xray</code> по старой инструкции, то он не запустится. Приносим извинения за неудобства!</p><ul><li>Верный путь: <code>/usr/local/etc/xray/config.json</code></li><li>Неверный путь: <code>/usr/local/etc/config.json</code></li></ul><p>Затронутые разделы:</p><ul><li>7.4 Настройка Xray - 3. Создание файла конфигурации <code>Xray</code> с помощью <code>nano</code></li><li>7.8 Оптимизация сервера: автоматическое перенаправление HTTP на HTTPS - 6. Изменяем настройки перенаправления в файле конфигурации Xray</li></ul></li><li><p>В первоначальной версии руководства была ошибка в настройках Nginx (неверный путь к папке с файлами сайта). Если вы настроили Nginx по старой инструкции, то сайт не будет работать. Приносим извинения за неудобства!</p><ul><li>Верный путь: <code>root /home/vpsadmin/www/webpage;</code></li><li>Неверный путь: <code>root /var/www/website/html</code></li></ul><p>Затронутые разделы:</p><ul><li>7.8 Оптимизация сервера: автоматическое перенаправление HTTP на HTTPS - 4. Добавляем новый сервер, который будет прослушивать локальный порт и отдавать файлы сайта.</li></ul></li></ol></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/xtls/Xray-docs-next/edit/main/docs/ru/document/level-0/ch07-xray-server.md" rel="noopener noreferrer" target="_blank" aria-label="Помогите нам улучшить эту страницу!"><!--[--><!--]--> Помогите нам улучшить эту страницу! <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Открыть в новой вкладке</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Последние изменения: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 104270279+iambabyninja@users.noreply.github.com">Nikita Korotaev</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav" aria-label="page navigation"><p class="inner"><span class="prev"><a href="/ru/document/level-0/ch06-certificates.html" class="" aria-label="【Глава 6】 Управление сертификатами"><!--[--><!--]--> 【Глава 6】 Управление сертификатами <!--[--><!--]--></a></span><span class="next"><a href="/ru/document/level-0/ch08-xray-clients.html" class="" aria-label="【Глава 8】Настройка Xray на клиенте"><!--[--><!--]--> 【Глава 8】Настройка Xray на клиенте <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-D0lKU3Y-.js" defer></script>
  </body>
</html>
